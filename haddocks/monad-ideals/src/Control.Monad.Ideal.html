<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-3"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Module      :  Control.Monad.ideal</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- Copyright   :  (C) 2008 Edward Kmett, (C) 2024 Koji Miyazato</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- License     :  BSD-style (see the file LICENSE)</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Maintainer  :  Koji Miyazato &lt;viercc@gmail.com&gt;</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Portability :  portable</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Monad.Ideal</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Ideal Monads</span></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier">MonadIdeal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#idealize"><span class="hs-identifier">idealize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier">Ideal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#ideal"><span class="hs-identifier">ideal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#runIdeal"><span class="hs-identifier">runIdeal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#hoistIdeal"><span class="hs-identifier">hoistIdeal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Control.Monad.Ideal.html#destroyIdeal"><span class="hs-identifier">destroyIdeal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Control.Monad.Ideal.html#bindDefault"><span class="hs-identifier">bindDefault</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Control.Monad.Ideal.html#impureBindDefault"><span class="hs-identifier">impureBindDefault</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Relation between @MonadIdeal@, @Bind@, and @Isolated@</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-comment">-- </span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- $relation_to_bind_and_isolate</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(|||)</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Bind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Bind</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WrappedMonad</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Monad.Isolated.html"><span class="hs-identifier">Control.Monad.Isolated</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><span class="hs-comment">-- | Ideal monad is a special case of @Unite m@</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">type</span><span> </span><span id="Ideal"><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-var">Ideal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Control.Monad.Isolated.html#Unite"><span class="hs-identifier hs-type">Unite</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><span class="hs-comment">-- | Constructor of @ideal@ = @Unite@ for backward compatibility</span></span><span>
</span><span id="line-41"></span><span id="local-6989586621679080262"><span id="local-6989586621679080263"><span class="annot"><a href="Control.Monad.Ideal.html#ideal"><span class="hs-identifier hs-type">ideal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679080262"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080263"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080262"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080263"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080262"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-42"></span><span id="ideal"><span class="annot"><span class="annottext">ideal :: forall a (m :: * -&gt; *). Either a (m a) -&gt; Ideal m a
</span><a href="Control.Monad.Ideal.html#ideal"><span class="hs-identifier hs-var hs-var">ideal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a (m a) -&gt; Unite m a
forall (f :: * -&gt; *) a. Either a (f a) -&gt; Unite f a
</span><a href="Control.Monad.Isolated.html#Unite"><span class="hs-identifier hs-var">Unite</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><span class="hs-comment">-- | Deconstructor of @ideal@ = @Unite@ for backward compatibility</span></span><span>
</span><span id="line-45"></span><span id="local-6989586621679080270"><span id="local-6989586621679080271"><span class="annot"><a href="Control.Monad.Ideal.html#runIdeal"><span class="hs-identifier hs-type">runIdeal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080270"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080271"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679080271"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080270"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080271"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-46"></span><span id="runIdeal"><span class="annot"><span class="annottext">runIdeal :: forall (m :: * -&gt; *) a. Ideal m a -&gt; Either a (m a)
</span><a href="Control.Monad.Ideal.html#runIdeal"><span class="hs-identifier hs-var hs-var">runIdeal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unite m a -&gt; Either a (m a)
forall (m :: * -&gt; *) a. Ideal m a -&gt; Either a (m a)
</span><a href="Control.Monad.Isolated.html#runUnite"><span class="hs-identifier hs-var">runUnite</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><span class="hs-comment">-- | Alias of 'hoistUnite' for naming consistently</span></span><span>
</span><span id="line-49"></span><span id="local-6989586621679080274"><span id="local-6989586621679080276"><span id="local-6989586621679080277"><span class="annot"><a href="Control.Monad.Ideal.html#hoistIdeal"><span class="hs-identifier hs-type">hoistIdeal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679080275"><span class="annot"><a href="#local-6989586621679080275"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679080274"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080275"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080276"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080275"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080274"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080277"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080276"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080277"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-50"></span><span id="hoistIdeal"><span class="annot"><span class="annottext">hoistIdeal :: forall (m :: * -&gt; *) (n :: * -&gt; *) b.
(forall a. m a -&gt; n a) -&gt; Ideal m b -&gt; Ideal n b
</span><a href="Control.Monad.Ideal.html#hoistIdeal"><span class="hs-identifier hs-var hs-var">hoistIdeal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; n a) -&gt; Unite m b -&gt; Unite n b
forall (m :: * -&gt; *) (n :: * -&gt; *) b.
(forall a. m a -&gt; n a) -&gt; Ideal m b -&gt; Ideal n b
</span><a href="Control.Monad.Isolated.html#hoistUnite"><span class="hs-identifier hs-var">hoistUnite</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">-- | @m@ is the &quot;ideal part&quot; of an ideal monad.</span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- ==== Laws</span><span>
</span><span id="line-55"></span><span class="hs-comment">--</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- Methods inherited from superclasses must be equivalent to the</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- canocical ones.</span><span>
</span><span id="line-58"></span><span class="hs-comment">--</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- - @'(&gt;&gt;-)' === 'bindDefault'@</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- - @'impureBind' === 'impureBindDefault'@</span><span>
</span><span id="line-61"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bind</span></span><span> </span><span class="annot"><a href="#local-6989586621679080282"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Control.Monad.Isolated.html#Isolated"><span class="hs-identifier hs-type">Isolated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080282"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="MonadIdeal"><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier hs-var">MonadIdeal</span></a></span></span><span> </span><span id="local-6989586621679080282"><span class="annot"><a href="#local-6989586621679080282"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>  </span><span id="idealBind"><span class="annot"><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-identifier hs-type">idealBind</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679080290"><span id="local-6989586621679080291"><span class="annot"><a href="#local-6989586621679080282"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080290"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080290"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080282"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080291"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080282"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080291"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-operator hs-type">`idealBind`</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span id="local-6989586621679080286"><span id="local-6989586621679080287"><span class="annot"><a href="Control.Monad.Ideal.html#idealize"><span class="hs-identifier hs-type">idealize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier hs-type">MonadIdeal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080286"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080286"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080286"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080287"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080286"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080287"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-67"></span><span id="idealize"><span class="annot"><span class="annottext">idealize :: forall (m :: * -&gt; *) a. MonadIdeal m =&gt; m (Ideal m a) -&gt; m a
</span><a href="Control.Monad.Ideal.html#idealize"><span class="hs-identifier hs-var hs-var">idealize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Ideal m a) -&gt; (Ideal m a -&gt; Ideal m a) -&gt; m a
forall a b. m a -&gt; (a -&gt; Ideal m b) -&gt; m b
forall (m :: * -&gt; *) a b.
MonadIdeal m =&gt;
m a -&gt; (a -&gt; Ideal m b) -&gt; m b
</span><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-operator hs-var">`idealBind`</span></a></span><span> </span><span class="annot"><span class="annottext">Ideal m a -&gt; Ideal m a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="annot"><span class="hs-comment">-- | 'MonadIdeal' implies 'Bind'</span></span><span>
</span><span id="line-70"></span><span id="local-6989586621679080293"><span id="local-6989586621679080294"><span id="local-6989586621679080295"><span class="annot"><a href="Control.Monad.Ideal.html#bindDefault"><span class="hs-identifier hs-type">bindDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier hs-type">MonadIdeal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080293"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080293"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080294"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080294"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080293"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080295"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080293"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080295"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-71"></span><span id="bindDefault"><span class="annot"><span class="annottext">bindDefault :: forall (m :: * -&gt; *) a b. MonadIdeal m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="Control.Monad.Ideal.html#bindDefault"><span class="hs-identifier hs-var hs-var">bindDefault</span></a></span></span><span> </span><span id="local-6989586621679080365"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679080365"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span id="local-6989586621679080366"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679080366"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679080365"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; Ideal m b) -&gt; m b
forall a b. m a -&gt; (a -&gt; Ideal m b) -&gt; m b
forall (m :: * -&gt; *) a b.
MonadIdeal m =&gt;
m a -&gt; (a -&gt; Ideal m b) -&gt; m b
</span><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-operator hs-var">`idealBind`</span></a></span><span> </span><span class="annot"><span class="annottext">Either b (m b) -&gt; Ideal m b
forall a (m :: * -&gt; *). Either a (m a) -&gt; Ideal m a
</span><a href="Control.Monad.Ideal.html#ideal"><span class="hs-identifier hs-var">ideal</span></a></span><span> </span><span class="annot"><span class="annottext">(Either b (m b) -&gt; Ideal m b)
-&gt; (a -&gt; Either b (m b)) -&gt; a -&gt; Ideal m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m b -&gt; Either b (m b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(m b -&gt; Either b (m b)) -&gt; (a -&gt; m b) -&gt; a -&gt; Either b (m b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679080366"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">-- | 'MonadIdeal' implies 'Isolated'</span></span><span>
</span><span id="line-74"></span><span id="local-6989586621679080304"><span id="local-6989586621679080305"><span id="local-6989586621679080306"><span class="annot"><a href="Control.Monad.Ideal.html#impureBindDefault"><span class="hs-identifier hs-type">impureBindDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier hs-type">MonadIdeal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080304"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080304"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080305"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080305"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Isolated.html#Unite"><span class="hs-identifier hs-type">Unite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080304"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080306"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Isolated.html#Unite"><span class="hs-identifier hs-type">Unite</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080304"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080306"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-75"></span><span id="impureBindDefault"><span class="annot"><span class="annottext">impureBindDefault :: forall (m :: * -&gt; *) a b.
MonadIdeal m =&gt;
m a -&gt; (a -&gt; Unite m b) -&gt; Unite m b
</span><a href="Control.Monad.Ideal.html#impureBindDefault"><span class="hs-identifier hs-var hs-var">impureBindDefault</span></a></span></span><span> </span><span id="local-6989586621679080370"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679080370"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span id="local-6989586621679080371"><span class="annot"><span class="annottext">a -&gt; Unite m b
</span><a href="#local-6989586621679080371"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either b (m b) -&gt; Unite m b
forall a (m :: * -&gt; *). Either a (m a) -&gt; Ideal m a
</span><a href="Control.Monad.Ideal.html#ideal"><span class="hs-identifier hs-var">ideal</span></a></span><span> </span><span class="annot"><span class="annottext">(Either b (m b) -&gt; Unite m b)
-&gt; (m b -&gt; Either b (m b)) -&gt; m b -&gt; Unite m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m b -&gt; Either b (m b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(m b -&gt; Unite m b) -&gt; m b -&gt; Unite m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679080370"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; Unite m b) -&gt; m b
forall a b. m a -&gt; (a -&gt; Ideal m b) -&gt; m b
forall (m :: * -&gt; *) a b.
MonadIdeal m =&gt;
m a -&gt; (a -&gt; Ideal m b) -&gt; m b
</span><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-operator hs-var">`idealBind`</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Unite m b
</span><a href="#local-6989586621679080371"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- | @ideal ((,) s) ~ (,) (Maybe s)@</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080315"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621679080315"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier hs-type">MonadIdeal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679080315"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621679080383"><span class="annot"><span class="annottext">idealBind :: forall a b. (s, a) -&gt; (a -&gt; Ideal ((,) s) b) -&gt; (s, b)
</span><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-identifier hs-var hs-var hs-var hs-var">idealBind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080384"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679080384"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679080385"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080385"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080386"><span class="annot"><span class="annottext">a -&gt; Ideal ((,) s) b
</span><a href="#local-6989586621679080386"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Ideal ((,) s) b -&gt; Either b (s, b)
forall (m :: * -&gt; *) a. Ideal m a -&gt; Either a (m a)
</span><a href="Control.Monad.Ideal.html#runIdeal"><span class="hs-identifier hs-var">runIdeal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Ideal ((,) s) b
</span><a href="#local-6989586621679080386"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080385"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679080387"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080387"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679080384"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080387"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080388"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679080388"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679080389"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080389"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679080384"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; s -&gt; s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679080388"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679080389"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><span class="hs-comment">-- | Any @Monad@ can be an ideal of @ideal m@</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080322"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679080322"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#MonadIdeal"><span class="hs-identifier hs-type">MonadIdeal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WrappedMonad</span></span><span> </span><span class="annot"><a href="#local-6989586621679080322"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>  </span><span id="local-6989586621679080403"><span class="annot"><span class="annottext">idealBind :: forall a b.
WrappedMonad m a
-&gt; (a -&gt; Ideal (WrappedMonad m) b) -&gt; WrappedMonad m b
</span><a href="Control.Monad.Ideal.html#idealBind"><span class="hs-identifier hs-var hs-var hs-var hs-var">idealBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WrapMonad</span></span><span> </span><span id="local-6989586621679080405"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679080405"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679080406"><span class="annot"><span class="annottext">a -&gt; Ideal (WrappedMonad m) b
</span><a href="#local-6989586621679080406"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m b -&gt; WrappedMonad m b
forall (m :: * -&gt; *) a. m a -&gt; WrappedMonad m a
</span><span class="hs-identifier hs-var">WrapMonad</span></span><span> </span><span class="annot"><span class="annottext">(m b -&gt; WrappedMonad m b) -&gt; m b -&gt; WrappedMonad m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679080405"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m b) -&gt; m b
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; m b)
-&gt; (WrappedMonad m b -&gt; m b) -&gt; Either b (WrappedMonad m b) -&gt; m b
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">WrappedMonad m b -&gt; m b
forall (m :: * -&gt; *) a. WrappedMonad m a -&gt; m a
</span><span class="hs-identifier hs-var">unwrapMonad</span></span><span> </span><span class="annot"><span class="annottext">(Either b (WrappedMonad m b) -&gt; m b)
-&gt; (a -&gt; Either b (WrappedMonad m b)) -&gt; a -&gt; m b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ideal (WrappedMonad m) b -&gt; Either b (WrappedMonad m b)
forall (m :: * -&gt; *) a. Ideal m a -&gt; Either a (m a)
</span><a href="Control.Monad.Ideal.html#runIdeal"><span class="hs-identifier hs-var">runIdeal</span></a></span><span> </span><span class="annot"><span class="annottext">(Ideal (WrappedMonad m) b -&gt; Either b (WrappedMonad m b))
-&gt; (a -&gt; Ideal (WrappedMonad m) b)
-&gt; a
-&gt; Either b (WrappedMonad m b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Ideal (WrappedMonad m) b
</span><a href="#local-6989586621679080406"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621679080336"><span id="local-6989586621679080337"><span class="annot"><a href="Control.Monad.Ideal.html#destroyIdeal"><span class="hs-identifier hs-type">destroyIdeal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679080336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080337"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080337"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Monad.Ideal.html#Ideal"><span class="hs-identifier hs-type">Ideal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080336"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080337"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679080337"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-88"></span><span id="destroyIdeal"><span class="annot"><span class="annottext">destroyIdeal :: forall (m :: * -&gt; *) a. (m a -&gt; a) -&gt; Ideal m a -&gt; a
</span><a href="Control.Monad.Ideal.html#destroyIdeal"><span class="hs-identifier hs-var hs-var">destroyIdeal</span></a></span></span><span> </span><span id="local-6989586621679080411"><span class="annot"><span class="annottext">m a -&gt; a
</span><a href="#local-6989586621679080411"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (m a -&gt; a) -&gt; Either a (m a) -&gt; a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
forall (a :: * -&gt; * -&gt; *) b d c.
ArrowChoice a =&gt;
a b d -&gt; a c d -&gt; a (Either b c) d
</span><span class="hs-operator hs-var">|||</span></span><span> </span><span class="annot"><span class="annottext">m a -&gt; a
</span><a href="#local-6989586621679080411"><span class="hs-identifier hs-var">phi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either a (m a) -&gt; a)
-&gt; (Ideal m a -&gt; Either a (m a)) -&gt; Ideal m a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ideal m a -&gt; Either a (m a)
forall (m :: * -&gt; *) a. Ideal m a -&gt; Either a (m a)
</span><a href="Control.Monad.Ideal.html#runIdeal"><span class="hs-identifier hs-var">runIdeal</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="annot"><span class="hs-comment">{- $relation_to_bind_and_isolate

@MonadIdeal@ is a requirement stronger than both of 'Bind' and 'Isolated'.
In fact, these subset relations hold.

- Every @MonadIdeal@ is @Bind@
- Every @MonadIdeal@ is @Isolated@

These are /strict/ subset relation and neither of three classes can be dropped.

- 'Data.List.NotOne.NotOne' is both @Bind@ and @Isolated@, but not @MonadIdeal@.

- @NullBind c@ is @Bind@ but can't be @Isolated@, because @Unite (NullBind c)@ can't be a @Monad@ in a compatible way.

    @
    newtype NullBind c a = NullBind (Maybe c)
    instance Bind (NullBind c a) where
      _ &gt;&gt;- _ = NullBind Nothing
    @

- @Toggle@ shown below is @Isolated@, but can't be a @Bind@ in a compatible way.

    @
    newtype Toggle a = Toggle a
      deriving Functor

    instance Isolated Toggle where
      impureBind (Toggle a) k = case k a of
        Unite (Left b)           -&gt; Unite (Right (Toggle b))
        Unite (Right (Toggle b)) -&gt; Unite (Left b)
    @

-}</span></span><span>
</span><span id="line-123"></span></pre></body></html>