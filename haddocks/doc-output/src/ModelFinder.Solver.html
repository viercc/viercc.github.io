<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ImportQualifiedPost #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">ModelFinder.Solver</span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Model</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier">Model</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier">lookupModel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Solvers</span></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><span class="hs-comment">-- | &quot;Default&quot; solve</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#solve"><span class="hs-identifier">solve</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Brute force</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#bruteforceSolve"><span class="hs-identifier">bruteforceSolve</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Solve but doesn't refine constraints  during solve</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#solveNoRefine"><span class="hs-identifier">solveNoRefine</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Solutions</span></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#Solution"><span class="hs-identifier">Solution</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#Def"><span class="hs-identifier">Def</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#constraintToSolution"><span class="hs-identifier">constraintToSolution</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">guard</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ap</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Constraint.Extras</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Dependent.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DMap</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Dependent.Sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DSum</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Compose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Compose</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.GADT.Compare</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maximumBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">comparing</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Some</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.GADT.Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GShow</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html"><span class="hs-identifier">ModelFinder.Expr</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">($&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- * Cached execution</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">type</span><span> </span><span id="Cache"><span class="annot"><a href="ModelFinder.Solver.html#Cache"><span class="hs-identifier hs-var">Cache</span></a></span></span><span> </span><span id="local-6989586621679137659"><span class="annot"><a href="#local-6989586621679137659"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DMap.DMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679137659"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span id="local-6989586621679137254"><span class="annot"><a href="ModelFinder.Solver.html#emptyCache"><span class="hs-identifier hs-type">emptyCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Cache"><span class="hs-identifier hs-type">Cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137254"><span class="hs-identifier hs-type">f</span></a></span></span><span>
</span><span id="line-60"></span><span id="emptyCache"><span class="annot"><span class="annottext">emptyCache :: forall (f :: * -&gt; *). Cache f
</span><a href="ModelFinder.Solver.html#emptyCache"><span class="hs-identifier hs-var hs-var">emptyCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DMap f Identity
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *). DMap k2 f
</span><span class="hs-identifier hs-var">DMap.empty</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">newtype</span><span> </span><span id="Cached"><span class="annot"><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span></span><span> </span><span id="local-6989586621679137262"><span class="annot"><a href="#local-6989586621679137262"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137263"><span class="annot"><a href="#local-6989586621679137263"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679137264"><span class="annot"><a href="#local-6989586621679137264"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Cached"><span class="annot"><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="runCached"><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (m :: * -&gt; *) a.
Cached f m a -&gt; Cache f -&gt; m (Cache f, a)
</span><a href="ModelFinder.Solver.html#runCached"><span class="hs-identifier hs-var hs-var">runCached</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Cache"><span class="hs-identifier hs-type">Cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137262"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137263"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Cache"><span class="hs-identifier hs-type">Cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137262"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679137264"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679137666"><span id="local-6989586621679137669"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b)
-&gt; (forall a b. a -&gt; Cached f m b -&gt; Cached f m a)
-&gt; Functor (Cached f m)
forall a b. a -&gt; Cached f m b -&gt; Cached f m a
forall a b. (a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
forall (f :: * -&gt; *) (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Cached f m b -&gt; Cached f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b
$cfmap :: forall (f :: * -&gt; *) (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b
fmap :: forall a b. (a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b
$c&lt;$ :: forall (f :: * -&gt; *) (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; Cached f m b -&gt; Cached f m a
&lt;$ :: forall a b. a -&gt; Cached f m b -&gt; Cached f m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679137292"><span id="local-6989586621679137293"><span id="local-6989586621679137680"><span id="local-6989586621679137684"><span id="local-6989586621679137687"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679137292"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137293"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137292"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-66"></span><span>  </span><span id="local-6989586621679137694"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; Cached f m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621679137695"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137695"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
</span><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span><span> </span><span class="annot"><span class="annottext">((Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a)
-&gt; (Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679137696"><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137696"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Cache f, a) -&gt; m (Cache f, a)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137696"><span class="hs-identifier hs-var">cache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137695"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span id="local-6989586621679137699"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. Cached f m (a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cached f m (a -&gt; b) -&gt; Cached f m a -&gt; Cached f m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><span class="hs-identifier hs-var">ap</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679137299"><span id="local-6989586621679137300"><span id="local-6989586621679137705"><span id="local-6989586621679137708"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679137299"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137300"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137299"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>  </span><span id="local-6989586621679137712"><span class="annot"><span class="annottext">Cached f m a
</span><a href="#local-6989586621679137712"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span id="local-6989586621679137713"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. Cached f m a -&gt; (a -&gt; Cached f m b) -&gt; Cached f m b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621679137714"><span class="annot"><span class="annottext">a -&gt; Cached f m b
</span><a href="#local-6989586621679137714"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Cache f -&gt; m (Cache f, b)) -&gt; Cached f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
</span><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span><span> </span><span class="annot"><span class="annottext">((Cache f -&gt; m (Cache f, b)) -&gt; Cached f m b)
-&gt; (Cache f -&gt; m (Cache f, b)) -&gt; Cached f m b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679137715"><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137715"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679137716"><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137716"><span class="hs-identifier hs-var">cache'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679137717"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137717"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cached f m a -&gt; Cache f -&gt; m (Cache f, a)
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
Cached f m a -&gt; Cache f -&gt; m (Cache f, a)
</span><a href="ModelFinder.Solver.html#runCached"><span class="hs-identifier hs-var">runCached</span></a></span><span> </span><span class="annot"><span class="annottext">Cached f m a
</span><a href="#local-6989586621679137712"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137715"><span class="hs-identifier hs-var">cache</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">Cached f m b -&gt; Cache f -&gt; m (Cache f, b)
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
Cached f m a -&gt; Cache f -&gt; m (Cache f, a)
</span><a href="ModelFinder.Solver.html#runCached"><span class="hs-identifier hs-var">runCached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Cached f m b
</span><a href="#local-6989586621679137714"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137717"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137716"><span class="hs-identifier hs-var">cache'</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><a href="ModelFinder.Solver.html#cached"><span class="hs-identifier hs-type">cached</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137315"><span class="annot"><a href="#local-6989586621679137315"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137317"><span class="annot"><a href="#local-6989586621679137317"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679137319"><span class="annot"><a href="#local-6989586621679137319"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137315"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679137317"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137318"><span class="annot"><a href="#local-6989586621679137318"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679137315"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137318"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137318"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137315"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137319"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137315"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137317"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137319"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-75"></span><span id="cached"><span class="annot"><span class="annottext">cached :: forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(GCompare f, Monad m) =&gt;
(forall x. f x -&gt; m x) -&gt; f a -&gt; Cached f m a
</span><a href="ModelFinder.Solver.html#cached"><span class="hs-identifier hs-var hs-var">cached</span></a></span></span><span> </span><span id="local-6989586621679137727"><span class="annot"><span class="annottext">forall x. f x -&gt; m x
</span><a href="#local-6989586621679137727"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621679137728"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679137728"><span class="hs-identifier hs-var">fa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
</span><a href="ModelFinder.Solver.html#Cached"><span class="hs-identifier hs-var">Cached</span></a></span><span> </span><span class="annot"><span class="annottext">((Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a)
-&gt; (Cache f -&gt; m (Cache f, a)) -&gt; Cached f m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679137729"><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137729"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">f a -&gt; Cache f -&gt; Maybe (Identity a)
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *) (v :: k1).
GCompare k2 =&gt;
k2 v -&gt; DMap k2 f -&gt; Maybe (f v)
</span><span class="hs-identifier hs-var">DMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679137728"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137729"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Identity a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f a -&gt; m a
forall x. f x -&gt; m x
</span><a href="#local-6989586621679137727"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679137728"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; (a -&gt; m (Cache f, a)) -&gt; m (Cache f, a)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679137731"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137731"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Cache f, a) -&gt; m (Cache f, a)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f a -&gt; Identity a -&gt; Cache f -&gt; Cache f
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *) (v :: k1).
GCompare k2 =&gt;
k2 v -&gt; f v -&gt; DMap k2 f -&gt; DMap k2 f
</span><span class="hs-identifier hs-var">DMap.insert</span></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679137728"><span class="hs-identifier hs-var">fa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Identity a
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137731"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137729"><span class="hs-identifier hs-var">cache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137731"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span id="local-6989586621679137734"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137734"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Cache f, a) -&gt; m (Cache f, a)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137729"><span class="hs-identifier hs-var">cache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679137734"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- Types for model search</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span> </span><span id="Model"><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-var">Model</span></a></span></span><span> </span><span id="local-6989586621679137377"><span class="annot"><a href="#local-6989586621679137377"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Model"><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-var">Model</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DMap.DMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679137377"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="local-6989586621679137342"><span id="local-6989586621679137739"><span id="local-6989586621679137745"><span id="local-6989586621679137749"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GShow</span></span><span> </span><span class="annot"><a href="#local-6989586621679137342"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679137342"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137342"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span id="local-6989586621679137343"><span id="local-6989586621679137344"><span class="annot"><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-type">lookupModel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137343"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137343"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137344"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137343"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679137344"><span class="hs-identifier hs-type">x</span></a></span></span></span><span>
</span><span id="line-87"></span><span id="lookupModel"><span class="annot"><span class="annottext">lookupModel :: forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var hs-var">lookupModel</span></a></span></span><span> </span><span id="local-6989586621679137754"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137754"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span id="local-6989586621679137755"><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679137755"><span class="hs-identifier hs-var">rel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set x -&gt; f x -&gt; DMap f Set -&gt; Set x
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *) (v :: k1).
GCompare k2 =&gt;
f v -&gt; k2 v -&gt; DMap k2 f -&gt; f v
</span><span class="hs-identifier hs-var">DMap.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Set x
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137754"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679137755"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621679137352"><span id="local-6989586621679137353"><span class="annot"><a href="ModelFinder.Solver.html#lookupKnown"><span class="hs-identifier hs-type">lookupKnown</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137352"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137352"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137353"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137352"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679137353"><span class="hs-identifier hs-type">x</span></a></span></span></span><span>
</span><span id="line-90"></span><span id="lookupKnown"><span class="annot"><span class="annottext">lookupKnown :: forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Maybe x
</span><a href="ModelFinder.Solver.html#lookupKnown"><span class="hs-identifier hs-var hs-var">lookupKnown</span></a></span></span><span> </span><span id="local-6989586621679137761"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137761"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679137762"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137762"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set x -&gt; [x]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Set x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var">lookupModel</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137761"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137762"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679137764"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679137764"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679137764"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">[x]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe x
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="local-6989586621679137358"><span id="local-6989586621679137359"><span class="annot"><a href="ModelFinder.Solver.html#guess"><span class="hs-identifier hs-type">guess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137358"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137358"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137358"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137359"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679137359"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-96"></span><span id="guess"><span class="annot"><span class="annottext">guess :: forall (f :: * -&gt; *) x. GCompare f =&gt; Model f -&gt; f x -&gt; [x]
</span><a href="ModelFinder.Solver.html#guess"><span class="hs-identifier hs-var hs-var">guess</span></a></span></span><span> </span><span id="local-6989586621679137768"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137768"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679137769"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137769"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set x -&gt; [x]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set x -&gt; [x]) -&gt; Set x -&gt; [x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Set x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var">lookupModel</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137769"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137768"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="ModelFinder.Solver.html#tighten"><span class="hs-identifier hs-type">tighten</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137362"><span class="annot"><a href="#local-6989586621679137362"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137364"><span class="annot"><a href="#local-6989586621679137364"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137362"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137362"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137362"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137364"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679137364"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137362"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#IsChanged"><span class="hs-identifier hs-type">IsChanged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137362"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span id="tighten"><span class="annot"><span class="annottext">tighten :: forall (f :: * -&gt; *) x.
(GCompare f, Has Ord f) =&gt;
f x -&gt; Set x -&gt; Model f -&gt; Maybe (IsChanged, Model f)
</span><a href="ModelFinder.Solver.html#tighten"><span class="hs-identifier hs-var hs-var">tighten</span></a></span></span><span> </span><span id="local-6989586621679137782"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137782"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679137783"><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137783"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span id="local-6989586621679137784"><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679137784"><span class="hs-identifier hs-var">rel</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Compose Maybe ((,) IsChanged) (Model f)
-&gt; Maybe (IsChanged, Model f)
forall {k1} {k2} (f :: k1 -&gt; *) (g :: k2 -&gt; k1) (a :: k2).
Compose f g a -&gt; f (g a)
</span><span class="hs-identifier hs-var">getCompose</span></span><span> </span><span class="annot"><span class="annottext">(Compose Maybe ((,) IsChanged) (Model f)
 -&gt; Maybe (IsChanged, Model f))
-&gt; Compose Maybe ((,) IsChanged) (Model f)
-&gt; Maybe (IsChanged, Model f)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DMap f Set -&gt; Model f)
-&gt; Compose Maybe ((,) IsChanged) (DMap f Set)
-&gt; Compose Maybe ((,) IsChanged) (Model f)
forall a b.
(a -&gt; b)
-&gt; Compose Maybe ((,) IsChanged) a
-&gt; Compose Maybe ((,) IsChanged) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DMap f Set -&gt; Model f
forall (f :: * -&gt; *). DMap f Set -&gt; Model f
</span><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-var">Model</span></a></span><span> </span><span class="annot"><span class="annottext">(Compose Maybe ((,) IsChanged) (DMap f Set)
 -&gt; Compose Maybe ((,) IsChanged) (Model f))
-&gt; Compose Maybe ((,) IsChanged) (DMap f Set)
-&gt; Compose Maybe ((,) IsChanged) (Model f)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f x
-&gt; (Maybe (Set x) -&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x)))
-&gt; DMap f Set
-&gt; Compose Maybe ((,) IsChanged) (DMap f Set)
forall {k1} (k2 :: k1 -&gt; *) (f :: * -&gt; *) (v :: k1) (g :: k1 -&gt; *).
(GCompare k2, Functor f) =&gt;
k2 v
-&gt; (Maybe (g v) -&gt; f (Maybe (g v))) -&gt; DMap k2 g -&gt; f (DMap k2 g)
</span><span class="hs-identifier hs-var">DMap.alterF</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137782"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Set x) -&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x))
</span><a href="#local-6989586621679137787"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679137784"><span class="hs-identifier hs-var">rel</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621679137787"><span class="annot"><span class="annottext">upd :: Maybe (Set x) -&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x))
</span><a href="#local-6989586621679137787"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set x)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (IsChanged, Maybe (Set x))
-&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x))
forall {k} {k1} (f :: k -&gt; *) (g :: k1 -&gt; k) (a :: k1).
f (g a) -&gt; Compose f g a
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="annot"><span class="annottext">Maybe (IsChanged, Maybe (Set x))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="#local-6989586621679137787"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679137789"><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137789"><span class="hs-identifier hs-var">xs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137782"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">((Ord x =&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x)))
 -&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x)))
-&gt; (Ord x =&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x)))
-&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679137802"><span class="annot"><span class="annottext">xs'' :: Set x
</span><a href="#local-6989586621679137802"><span class="hs-identifier hs-var hs-var">xs''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Set x -&gt; Set x
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.intersection</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137783"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137789"><span class="hs-identifier hs-var">xs'</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span id="local-6989586621679137804"><span class="annot"><span class="annottext">changed :: IsChanged
</span><a href="#local-6989586621679137804"><span class="hs-identifier hs-var hs-var">changed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137789"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Set x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137802"><span class="hs-identifier hs-var">xs''</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><a href="ModelFinder.Expr.html#NoChange"><span class="hs-identifier hs-var">NoChange</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IsChanged
</span><a href="ModelFinder.Expr.html#Changed"><span class="hs-identifier hs-var">Changed</span></a></span><span>
</span><span id="line-106"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe (IsChanged, Maybe (Set x))
-&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x))
forall {k} {k1} (f :: k -&gt; *) (g :: k1 -&gt; k) (a :: k1).
f (g a) -&gt; Compose f g a
</span><span class="hs-identifier hs-var">Compose</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (IsChanged, Maybe (Set x))
 -&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x)))
-&gt; Maybe (IsChanged, Maybe (Set x))
-&gt; Compose Maybe ((,) IsChanged) (Maybe (Set x))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set x -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137802"><span class="hs-identifier hs-var">xs''</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ()
-&gt; Maybe (IsChanged, Maybe (Set x))
-&gt; Maybe (IsChanged, Maybe (Set x))
forall a b. Maybe a -&gt; Maybe b -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(IsChanged, Maybe (Set x)) -&gt; Maybe (IsChanged, Maybe (Set x))
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><a href="#local-6989586621679137804"><span class="hs-identifier hs-var">changed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Maybe (Set x)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137802"><span class="hs-identifier hs-var">xs''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- Blocker</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">newtype</span><span> </span><span id="Blocker"><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span></span><span> </span><span id="local-6989586621679137400"><span class="annot"><a href="#local-6989586621679137400"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137401"><span class="annot"><a href="#local-6989586621679137401"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Blocker"><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getBlockerMap"><span class="annot"><span class="annottext">forall (f :: * -&gt; *) k. Blocker f k -&gt; Map (Some f) (Set k)
</span><a href="ModelFinder.Solver.html#getBlockerMap"><span class="hs-identifier hs-var hs-var">getBlockerMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="annot"><a href="#local-6989586621679137400"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679137401"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679137412"><span id="local-6989586621679137413"><span id="local-6989586621679137815"><span id="local-6989586621679137819"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137412"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137413"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137412"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137413"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span id="local-6989586621679137827"><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137827"><span class="hs-identifier hs-var">bm</span></a></span></span><span> </span><span id="local-6989586621679137828"><span class="annot"><span class="annottext">&lt;&gt; :: Blocker f k -&gt; Blocker f k -&gt; Blocker f k
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span id="local-6989586621679137829"><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137829"><span class="hs-identifier hs-var">bm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Blocker f k
forall (f :: * -&gt; *) k. Map (Some f) (Set k) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Some f) (Set k) -&gt; Blocker f k)
-&gt; Map (Some f) (Set k) -&gt; Blocker f k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Set k -&gt; Set k -&gt; Set k)
-&gt; Map (Some f) (Set k)
-&gt; Map (Some f) (Set k)
-&gt; Map (Some f) (Set k)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">Set k -&gt; Set k -&gt; Set k
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137827"><span class="hs-identifier hs-var">bm</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137829"><span class="hs-identifier hs-var">bm'</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679137421"><span id="local-6989586621679137422"><span id="local-6989586621679137838"><span id="local-6989586621679137842"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137421"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137422"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137421"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137422"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679137845"><span class="annot"><span class="annottext">mempty :: Blocker f k
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Blocker f k
forall (f :: * -&gt; *) k. Map (Some f) (Set k) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span id="local-6989586621679137425"><span id="local-6989586621679137426"><span class="annot"><a href="ModelFinder.Solver.html#mostWanted"><span class="hs-identifier hs-type">mostWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137425"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137426"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="annot"><a href="#local-6989586621679137425"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-119"></span><span id="mostWanted"><span class="annot"><span class="annottext">mostWanted :: forall (f :: * -&gt; *) k. Blocker f k -&gt; Maybe (Some f)
</span><a href="ModelFinder.Solver.html#mostWanted"><span class="hs-identifier hs-var hs-var">mostWanted</span></a></span></span><span> </span><span id="local-6989586621679137851"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679137851"><span class="hs-identifier hs-var">blocker</span></a></span></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137853"><span class="hs-identifier hs-var">bm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Some f)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Some f -&gt; Maybe (Some f)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Some f -&gt; Maybe (Some f)) -&gt; Some f -&gt; Maybe (Some f)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Some f, Set k) -&gt; Some f
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Some f, Set k) -&gt; Some f) -&gt; (Some f, Set k) -&gt; Some f
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Some f, Set k) -&gt; (Some f, Set k) -&gt; Ordering)
-&gt; [(Some f, Set k)] -&gt; (Some f, Set k)
forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximumBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Some f, Set k) -&gt; Int)
-&gt; (Some f, Set k) -&gt; (Some f, Set k) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><span class="hs-identifier hs-var">comparing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">(Set k -&gt; Int)
-&gt; ((Some f, Set k) -&gt; Set k) -&gt; (Some f, Set k) -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Some f, Set k) -&gt; Set k
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Some f, Set k)] -&gt; (Some f, Set k))
-&gt; [(Some f, Set k)] -&gt; (Some f, Set k)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; [(Some f, Set k)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137853"><span class="hs-identifier hs-var">bm</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679137853"><span class="annot"><span class="annottext">bm :: Map (Some f) (Set k)
</span><a href="#local-6989586621679137853"><span class="hs-identifier hs-var hs-var">bm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker f k -&gt; Map (Some f) (Set k)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Map (Some f) (Set k)
</span><a href="ModelFinder.Solver.html#getBlockerMap"><span class="hs-identifier hs-var">getBlockerMap</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679137851"><span class="hs-identifier hs-var">blocker</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="ModelFinder.Solver.html#demandSet"><span class="hs-identifier hs-type">demandSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137445"><span class="annot"><a href="#local-6989586621679137445"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137445"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137445"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="annot"><a href="#local-6989586621679137445"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span id="demandSet"><span class="annot"><span class="annottext">demandSet :: forall (f :: * -&gt; *). GCompare f =&gt; Property f -&gt; Set (Some f)
</span><a href="ModelFinder.Solver.html#demandSet"><span class="hs-identifier hs-var hs-var">demandSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Some f] -&gt; Set (Some f)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Some f] -&gt; Set (Some f))
-&gt; (Property f -&gt; [Some f]) -&gt; Property f -&gt; Set (Some f)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Property f -&gt; [Some f]
forall (f :: * -&gt; *). Property f -&gt; [Some f]
</span><a href="ModelFinder.Expr.html#getDemandsProperty"><span class="hs-identifier hs-var">getDemandsProperty</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span id="local-6989586621679137450"><span id="local-6989586621679137451"><span class="annot"><a href="ModelFinder.Solver.html#singleBlocker"><span class="hs-identifier hs-type">singleBlocker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137450"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137451"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679137451"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137450"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137450"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137451"><span class="hs-identifier hs-type">k</span></a></span></span></span><span>
</span><span id="line-129"></span><span id="singleBlocker"><span class="annot"><span class="annottext">singleBlocker :: forall (f :: * -&gt; *) k.
(GCompare f, Ord k) =&gt;
(k, Property f) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#singleBlocker"><span class="hs-identifier hs-var hs-var">singleBlocker</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679137868"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679137868"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679137869"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679137869"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Blocker f k
forall (f :: * -&gt; *) k. Map (Some f) (Set k) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Some f) (Set k) -&gt; Blocker f k)
-&gt; Map (Some f) (Set k) -&gt; Blocker f k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Some f -&gt; Set k) -&gt; Set (Some f) -&gt; Map (Some f) (Set k)
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k -&gt; Some f -&gt; Set k
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; Set k
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679137868"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Property f -&gt; Set (Some f)
forall (f :: * -&gt; *). GCompare f =&gt; Property f -&gt; Set (Some f)
</span><a href="ModelFinder.Solver.html#demandSet"><span class="hs-identifier hs-var">demandSet</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679137869"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span id="local-6989586621679137459"><span id="local-6989586621679137460"><span class="annot"><a href="ModelFinder.Solver.html#updateBlocker"><span class="hs-identifier hs-type">updateBlocker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137459"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137460"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137460"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="annot"><a href="#local-6989586621679137459"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="annot"><a href="#local-6989586621679137459"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137459"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137460"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137459"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137460"><span class="hs-identifier hs-type">k</span></a></span></span></span><span>
</span><span id="line-132"></span><span id="updateBlocker"><span class="annot"><span class="annottext">updateBlocker :: forall (f :: * -&gt; *) k.
(GCompare f, Ord k) =&gt;
k -&gt; Set (Some f) -&gt; Set (Some f) -&gt; Blocker f k -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#updateBlocker"><span class="hs-identifier hs-var hs-var">updateBlocker</span></a></span></span><span> </span><span id="local-6989586621679137882"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679137882"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679137883"><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137883"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621679137884"><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137884"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span id="local-6989586621679137885"><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137885"><span class="hs-identifier hs-var">bm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Blocker f k
forall (f :: * -&gt; *) k. Map (Some f) (Set k) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137886"><span class="hs-identifier hs-var">bm''</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679137887"><span class="annot"><span class="annottext">deletion :: Set (Some f)
</span><a href="#local-6989586621679137887"><span class="hs-identifier hs-var hs-var">deletion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137883"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Some f) -&gt; Set (Some f) -&gt; Set (Some f)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137884"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679137889"><span class="annot"><span class="annottext">addition :: Set (Some f)
</span><a href="#local-6989586621679137889"><span class="hs-identifier hs-var hs-var">addition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137884"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Some f) -&gt; Set (Some f) -&gt; Set (Some f)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137883"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679137890"><span class="annot"><span class="annottext">bm' :: Map (Some f) (Set k)
</span><a href="#local-6989586621679137890"><span class="hs-identifier hs-var hs-var">bm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (Some f) (Set k) -&gt; Some f -&gt; Map (Some f) (Set k))
-&gt; Map (Some f) (Set k) -&gt; Set (Some f) -&gt; Map (Some f) (Set k)
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679137892"><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137892"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679137893"><span class="annot"><span class="annottext">Some f
</span><a href="#local-6989586621679137893"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Set k -&gt; Set k)
-&gt; Some f -&gt; Map (Some f) (Set k) -&gt; Map (Some f) (Set k)
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; Set k -&gt; Set k
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679137882"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Some f
</span><a href="#local-6989586621679137893"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137892"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137885"><span class="hs-identifier hs-var">bm</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137887"><span class="hs-identifier hs-var">deletion</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679137886"><span class="annot"><span class="annottext">bm'' :: Map (Some f) (Set k)
</span><a href="#local-6989586621679137886"><span class="hs-identifier hs-var hs-var">bm''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (Some f) (Set k) -&gt; Some f -&gt; Map (Some f) (Set k))
-&gt; Map (Some f) (Set k) -&gt; Set (Some f) -&gt; Map (Some f) (Set k)
forall a b. (a -&gt; b -&gt; a) -&gt; a -&gt; Set b -&gt; a
</span><span class="hs-identifier hs-var">Set.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679137896"><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137896"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679137897"><span class="annot"><span class="annottext">Some f
</span><a href="#local-6989586621679137897"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Set k -&gt; Set k)
-&gt; Some f -&gt; Map (Some f) (Set k) -&gt; Map (Some f) (Set k)
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; Set k -&gt; Set k
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679137882"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Some f
</span><a href="#local-6989586621679137897"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137896"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k)
</span><a href="#local-6989586621679137890"><span class="hs-identifier hs-var">bm'</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Some f)
</span><a href="#local-6989586621679137889"><span class="hs-identifier hs-var">addition</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="hs-comment">-- Refining</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span id="local-6989586621679137468"><span id="local-6989586621679137469"><span class="annot"><a href="ModelFinder.Solver.html#refineComplex"><span class="hs-identifier hs-type">refineComplex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137468"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137468"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137468"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Requests"><span class="hs-identifier hs-type">Requests</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137468"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137469"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679137469"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137468"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DSum</span></span><span> </span><span class="annot"><a href="#local-6989586621679137468"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-142"></span><span id="refineComplex"><span class="annot"><span class="annottext">refineComplex :: forall (f :: * -&gt; *) xs.
(GCompare f, Has Ord f) =&gt;
Int
-&gt; Model f
-&gt; Requests f xs
-&gt; (xs -&gt; Property f)
-&gt; Maybe [DSum f Set]
</span><a href="ModelFinder.Solver.html#refineComplex"><span class="hs-identifier hs-var hs-var">refineComplex</span></a></span></span><span> </span><span id="local-6989586621679137911"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679137911"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621679137912"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137912"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679137913"><span class="annot"><span class="annottext">Requests f xs
</span><a href="#local-6989586621679137913"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679137914"><span class="annot"><span class="annottext">xs -&gt; Property f
</span><a href="#local-6989586621679137914"><span class="hs-identifier hs-var">cont</span></a></span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(Cache f, xs)]
</span><a href="#local-6989586621679137915"><span class="hs-identifier hs-var">candidates</span></a></span><span> </span><span class="annot"><span class="annottext">[(Cache f, xs)] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="ModelFinder.Solver.html#longerThan"><span class="hs-operator hs-var">`longerThan`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679137911"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DSum f Set] -&gt; Maybe [DSum f Set]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Giving up == no new constraints</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[DMap f Set] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DMap f Set]
</span><a href="#local-6989586621679137918"><span class="hs-identifier hs-var">admissibleCaches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [DSum f Set]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DSum f Set] -&gt; Maybe [DSum f Set]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679137919"><span class="hs-identifier hs-var">newConstraints</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621679137915"><span class="annot"><span class="annottext">candidates :: [(Cache f, xs)]
</span><a href="#local-6989586621679137915"><span class="hs-identifier hs-var hs-var">candidates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cached f [] xs -&gt; Cache f -&gt; [(Cache f, xs)]
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
Cached f m a -&gt; Cache f -&gt; m (Cache f, a)
</span><a href="ModelFinder.Solver.html#runCached"><span class="hs-identifier hs-var">runCached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. f x -&gt; Cached f [] x) -&gt; Requests f xs -&gt; Cached f [] xs
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
Monad m =&gt;
(forall x. f x -&gt; m x) -&gt; Requests f a -&gt; m a
</span><a href="ModelFinder.Expr.html#evaluateReq"><span class="hs-identifier hs-var">evaluateReq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. f x -&gt; [x]) -&gt; f x -&gt; Cached f [] x
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(GCompare f, Monad m) =&gt;
(forall x. f x -&gt; m x) -&gt; f a -&gt; Cached f m a
</span><a href="ModelFinder.Solver.html#cached"><span class="hs-identifier hs-var">cached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Model f -&gt; f x -&gt; [x]
forall (f :: * -&gt; *) x. GCompare f =&gt; Model f -&gt; f x -&gt; [x]
</span><a href="ModelFinder.Solver.html#guess"><span class="hs-identifier hs-var">guess</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137912"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Requests f xs
</span><a href="#local-6989586621679137913"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cache f
forall (f :: * -&gt; *). Cache f
</span><a href="ModelFinder.Solver.html#emptyCache"><span class="hs-identifier hs-var">emptyCache</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679137924"><span class="annot"><span class="annottext">succeeds :: (Cache f, xs) -&gt; Bool
</span><a href="#local-6989586621679137924"><span class="hs-identifier hs-var hs-var">succeeds</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679137925"><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137925"><span class="hs-identifier hs-var">cache</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679137926"><span class="annot"><span class="annottext">xs
</span><a href="#local-6989586621679137926"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ((Cache f, Bool) -&gt; Bool) -&gt; [(Cache f, Bool)] -&gt; Bool
forall a. Int -&gt; (a -&gt; Bool) -&gt; [a] -&gt; Bool
</span><a href="ModelFinder.Solver.html#anyWithLimit"><span class="hs-identifier hs-var">anyWithLimit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679137911"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">(Cache f, Bool) -&gt; Bool
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Cache f, Bool)] -&gt; Bool) -&gt; [(Cache f, Bool)] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cached f [] Bool -&gt; Cache f -&gt; [(Cache f, Bool)]
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
Cached f m a -&gt; Cache f -&gt; m (Cache f, a)
</span><a href="ModelFinder.Solver.html#runCached"><span class="hs-identifier hs-var">runCached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. f x -&gt; Cached f [] x) -&gt; Property f -&gt; Cached f [] Bool
forall (f :: * -&gt; *) (m :: * -&gt; *).
(Has Ord f, Monad m) =&gt;
(forall x. f x -&gt; m x) -&gt; Property f -&gt; m Bool
</span><a href="ModelFinder.Solver.html#evaluatePropertyOrd"><span class="hs-identifier hs-var">evaluatePropertyOrd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. f x -&gt; [x]) -&gt; f x -&gt; Cached f [] x
forall (f :: * -&gt; *) (m :: * -&gt; *) a.
(GCompare f, Monad m) =&gt;
(forall x. f x -&gt; m x) -&gt; f a -&gt; Cached f m a
</span><a href="ModelFinder.Solver.html#cached"><span class="hs-identifier hs-var">cached</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Model f -&gt; f x -&gt; [x]
forall (f :: * -&gt; *) x. GCompare f =&gt; Model f -&gt; f x -&gt; [x]
</span><a href="ModelFinder.Solver.html#guess"><span class="hs-identifier hs-var">guess</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137912"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">xs -&gt; Property f
</span><a href="#local-6989586621679137914"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">xs
</span><a href="#local-6989586621679137926"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cache f
</span><a href="#local-6989586621679137925"><span class="hs-identifier hs-var">cache</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679137918"><span class="annot"><span class="annottext">admissibleCaches :: [DMap f Set]
</span><a href="#local-6989586621679137918"><span class="hs-identifier hs-var hs-var">admissibleCaches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall v. Identity v -&gt; Set v) -&gt; Cache f -&gt; DMap f Set
forall {k1} (f :: k1 -&gt; *) (g :: k1 -&gt; *) (k2 :: k1 -&gt; *).
(forall (v :: k1). f v -&gt; g v) -&gt; DMap k2 f -&gt; DMap k2 g
</span><span class="hs-identifier hs-var">DMap.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Set v
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; Set v) -&gt; (Identity v -&gt; v) -&gt; Identity v -&gt; Set v
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity v -&gt; v
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cache f -&gt; DMap f Set)
-&gt; ((Cache f, xs) -&gt; Cache f) -&gt; (Cache f, xs) -&gt; DMap f Set
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Cache f, xs) -&gt; Cache f
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Cache f, xs) -&gt; DMap f Set) -&gt; [(Cache f, xs)] -&gt; [DMap f Set]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Cache f, xs) -&gt; Bool) -&gt; [(Cache f, xs)] -&gt; [(Cache f, xs)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(Cache f, xs) -&gt; Bool
</span><a href="#local-6989586621679137924"><span class="hs-identifier hs-var">succeeds</span></a></span><span> </span><span class="annot"><span class="annottext">[(Cache f, xs)]
</span><a href="#local-6989586621679137915"><span class="hs-identifier hs-var">candidates</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679137919"><span class="annot"><span class="annottext">newConstraints :: [DSum f Set]
</span><a href="#local-6989586621679137919"><span class="hs-identifier hs-var hs-var">newConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DMap f Set -&gt; [DSum f Set]
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *).
DMap k2 f -&gt; [DSum k2 f]
</span><span class="hs-identifier hs-var">DMap.toList</span></span><span> </span><span class="annot"><span class="annottext">(DMap f Set -&gt; [DSum f Set]) -&gt; DMap f Set -&gt; [DSum f Set]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(forall v. f v -&gt; Set v -&gt; Set v -&gt; Set v)
-&gt; [DMap f Set] -&gt; DMap f Set
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *).
GCompare k2 =&gt;
(forall (v :: k1). k2 v -&gt; f v -&gt; f v -&gt; f v)
-&gt; [DMap k2 f] -&gt; DMap k2 f
</span><span class="hs-identifier hs-var">DMap.unionsWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679137938"><span class="annot"><span class="annottext">f v
</span><a href="#local-6989586621679137938"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679137939"><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679137939"><span class="hs-identifier hs-var">xs1</span></a></span></span><span> </span><span id="local-6989586621679137940"><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679137940"><span class="hs-identifier hs-var">xs2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f v
</span><a href="#local-6989586621679137938"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set v -&gt; Set v -&gt; Set v
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679137939"><span class="hs-identifier hs-var">xs1</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679137940"><span class="hs-identifier hs-var">xs2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DMap f Set]
</span><a href="#local-6989586621679137918"><span class="hs-identifier hs-var">admissibleCaches</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span id="local-6989586621679137508"><span class="annot"><a href="ModelFinder.Solver.html#refineSimple"><span class="hs-identifier hs-type">refineSimple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137508"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137508"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137508"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#SimpleProp"><span class="hs-identifier hs-type">SimpleProp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137508"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#IsDeleted"><span class="hs-identifier hs-type">IsDeleted</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DSum</span></span><span> </span><span class="annot"><a href="#local-6989586621679137508"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-153"></span><span id="refineSimple"><span class="annot"><span class="annottext">refineSimple :: forall (f :: * -&gt; *).
(GCompare f, Has Ord f) =&gt;
Model f -&gt; SimpleProp f -&gt; Maybe (IsDeleted, [DSum f Set])
</span><a href="ModelFinder.Solver.html#refineSimple"><span class="hs-identifier hs-var hs-var">refineSimple</span></a></span></span><span> </span><span id="local-6989586621679137946"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137946"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679137947"><span class="annot"><span class="annottext">SimpleProp f
</span><a href="#local-6989586621679137947"><span class="hs-identifier hs-var">prop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SimpleProp f
</span><a href="#local-6989586621679137947"><span class="hs-identifier hs-var">prop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><a href="ModelFinder.Expr.html#PropBool"><span class="hs-identifier hs-type">PropBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IsDeleted, [DSum f Set])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="ModelFinder.Expr.html#PropBool"><span class="hs-identifier hs-type">PropBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(IsDeleted, [DSum f Set]) -&gt; Maybe (IsDeleted, [DSum f Set])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsDeleted
</span><a href="ModelFinder.Solver.html#DeleteIt"><span class="hs-identifier hs-var">DeleteIt</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="ModelFinder.Expr.html#PropDef"><span class="hs-identifier hs-type">PropDef</span></a></span><span> </span><span id="local-6989586621679137952"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137952"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679137953"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679137953"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137952"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">((Ord x =&gt; Maybe (IsDeleted, [DSum f Set]))
 -&gt; Maybe (IsDeleted, [DSum f Set]))
-&gt; (Ord x =&gt; Maybe (IsDeleted, [DSum f Set]))
-&gt; Maybe (IsDeleted, [DSum f Set])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679137953"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; Set x -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Set x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var">lookupModel</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137952"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137946"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ()
-&gt; (IsDeleted, [DSum f Set]) -&gt; Maybe (IsDeleted, [DSum f Set])
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsDeleted
</span><a href="ModelFinder.Solver.html#DeleteIt"><span class="hs-identifier hs-var">DeleteIt</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137952"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Set x -&gt; DSum f Set
forall {k} (tag :: k -&gt; *) (f :: k -&gt; *) (a :: k).
tag a -&gt; f a -&gt; DSum tag f
</span><span class="hs-operator hs-var">:=&gt;</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; Set x
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679137953"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="ModelFinder.Expr.html#PropSimpleEq"><span class="hs-identifier hs-type">PropSimpleEq</span></a></span><span> </span><span id="local-6989586621679137963"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137963"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679137964"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137964"><span class="hs-identifier hs-var">fy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137963"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">((Ord x =&gt; Maybe (IsDeleted, [DSum f Set]))
 -&gt; Maybe (IsDeleted, [DSum f Set]))
-&gt; (Ord x =&gt; Maybe (IsDeleted, [DSum f Set]))
-&gt; Maybe (IsDeleted, [DSum f Set])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679137974"><span class="annot"><span class="annottext">xs :: Set x
</span><a href="#local-6989586621679137974"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Set x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var">lookupModel</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137963"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137946"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-160"></span><span>        </span><span id="local-6989586621679137975"><span class="annot"><span class="annottext">ys :: Set x
</span><a href="#local-6989586621679137975"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Set x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var">lookupModel</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137964"><span class="hs-identifier hs-var">fy</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137946"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span id="local-6989586621679137976"><span class="annot"><span class="annottext">xys :: Set x
</span><a href="#local-6989586621679137976"><span class="hs-identifier hs-var hs-var">xys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Set x -&gt; Set x
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.intersection</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137974"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137975"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span id="local-6989586621679137977"><span class="annot"><span class="annottext">changes :: [DSum f Set]
</span><a href="#local-6989586621679137977"><span class="hs-identifier hs-var hs-var">changes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137963"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Set x -&gt; DSum f Set
forall {k} (tag :: k -&gt; *) (f :: k -&gt; *) (a :: k).
tag a -&gt; f a -&gt; DSum tag f
</span><span class="hs-operator hs-var">:=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137976"><span class="hs-identifier hs-var">xys</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137974"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Set x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137976"><span class="hs-identifier hs-var">xys</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[DSum f Set] -&gt; [DSum f Set] -&gt; [DSum f Set]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137964"><span class="hs-identifier hs-var">fy</span></a></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Set x -&gt; DSum f Set
forall {k} (tag :: k -&gt; *) (f :: k -&gt; *) (a :: k).
tag a -&gt; f a -&gt; DSum tag f
</span><span class="hs-operator hs-var">:=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137976"><span class="hs-identifier hs-var">xys</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137975"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Set x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137976"><span class="hs-identifier hs-var">xys</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set x -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137976"><span class="hs-identifier hs-var">xys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ()
-&gt; (IsDeleted, [DSum f Set]) -&gt; Maybe (IsDeleted, [DSum f Set])
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsDeleted
</span><a href="ModelFinder.Solver.html#KeepIt"><span class="hs-identifier hs-var">KeepIt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679137977"><span class="hs-identifier hs-var">changes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="ModelFinder.Expr.html#PropSimplePred"><span class="hs-identifier hs-type">PropSimplePred</span></a></span><span> </span><span id="local-6989586621679137982"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137982"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679137983"><span class="annot"><span class="annottext">x -&gt; Bool
</span><a href="#local-6989586621679137983"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137982"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">((Ord x =&gt; Maybe (IsDeleted, [DSum f Set]))
 -&gt; Maybe (IsDeleted, [DSum f Set]))
-&gt; (Ord x =&gt; Maybe (IsDeleted, [DSum f Set]))
-&gt; Maybe (IsDeleted, [DSum f Set])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679137990"><span class="annot"><span class="annottext">xs :: Set x
</span><a href="#local-6989586621679137990"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Set x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Set x
</span><a href="ModelFinder.Solver.html#lookupModel"><span class="hs-identifier hs-var">lookupModel</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137982"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679137946"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span id="local-6989586621679137991"><span class="annot"><span class="annottext">xs' :: Set x
</span><a href="#local-6989586621679137991"><span class="hs-identifier hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(x -&gt; Bool) -&gt; Set x -&gt; Set x
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; Bool
</span><a href="#local-6989586621679137983"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137990"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set x -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137991"><span class="hs-identifier hs-var">xs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ()
-&gt; (IsDeleted, [DSum f Set]) -&gt; Maybe (IsDeleted, [DSum f Set])
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsDeleted
</span><a href="ModelFinder.Solver.html#DeleteIt"><span class="hs-identifier hs-var">DeleteIt</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137982"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">f x -&gt; Set x -&gt; DSum f Set
forall {k} (tag :: k -&gt; *) (f :: k -&gt; *) (a :: k).
tag a -&gt; f a -&gt; DSum tag f
</span><span class="hs-operator hs-var">:=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137991"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137990"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Set x -&gt; Set x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Set x
</span><a href="#local-6989586621679137991"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">data</span><span> </span><span id="IsDeleted"><span class="annot"><a href="ModelFinder.Solver.html#IsDeleted"><span class="hs-identifier hs-var">IsDeleted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DeleteIt"><span class="annot"><a href="ModelFinder.Solver.html#DeleteIt"><span class="hs-identifier hs-var">DeleteIt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="KeepIt"><span class="annot"><a href="ModelFinder.Solver.html#KeepIt"><span class="hs-identifier hs-var">KeepIt</span></a></span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span id="local-6989586621679137484"><span id="local-6989586621679137485"><span class="annot"><a href="ModelFinder.Solver.html#evaluatePropertyOrd"><span class="hs-identifier hs-type">evaluatePropertyOrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137484"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679137485"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137486"><span class="annot"><a href="#local-6989586621679137486"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679137484"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137486"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137485"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137486"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137484"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137485"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-172"></span><span id="evaluatePropertyOrd"><span class="annot"><span class="annottext">evaluatePropertyOrd :: forall (f :: * -&gt; *) (m :: * -&gt; *).
(Has Ord f, Monad m) =&gt;
(forall x. f x -&gt; m x) -&gt; Property f -&gt; m Bool
</span><a href="ModelFinder.Solver.html#evaluatePropertyOrd"><span class="hs-identifier hs-var hs-var">evaluatePropertyOrd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; x -&gt; x -&gt; Bool)
-&gt; (forall x. f x -&gt; m x) -&gt; Property f -&gt; m Bool
forall (f :: * -&gt; *) (m :: * -&gt; *).
Monad m =&gt;
(forall x. f x -&gt; x -&gt; x -&gt; Bool)
-&gt; (forall x. f x -&gt; m x) -&gt; Property f -&gt; m Bool
</span><a href="ModelFinder.Expr.html#evaluatePropertyWith"><span class="hs-identifier hs-var">evaluatePropertyWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679137998"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137998"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679137998"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; x -&gt; Bool
Ord x =&gt; x -&gt; x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span id="local-6989586621679137532"><span class="annot"><a href="ModelFinder.Solver.html#reducePropertyOrd"><span class="hs-identifier hs-type">reducePropertyOrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137532"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137533"><span class="annot"><a href="#local-6989586621679137533"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679137532"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137533"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679137533"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137532"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#IsChanged"><span class="hs-identifier hs-type">IsChanged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137532"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-175"></span><span id="reducePropertyOrd"><span class="annot"><span class="annottext">reducePropertyOrd :: forall (f :: * -&gt; *).
Has Ord f =&gt;
(forall x. f x -&gt; Maybe x) -&gt; Property f -&gt; (IsChanged, Property f)
</span><a href="ModelFinder.Solver.html#reducePropertyOrd"><span class="hs-identifier hs-var hs-var">reducePropertyOrd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; x -&gt; x -&gt; Bool)
-&gt; (forall x. f x -&gt; Maybe x)
-&gt; Property f
-&gt; (IsChanged, Property f)
forall (f :: * -&gt; *).
(forall x. f x -&gt; x -&gt; x -&gt; Bool)
-&gt; (forall x. f x -&gt; Maybe x)
-&gt; Property f
-&gt; (IsChanged, Property f)
</span><a href="ModelFinder.Expr.html#reducePropertyWith"><span class="hs-identifier hs-var">reducePropertyWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679138006"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138006"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138006"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; x -&gt; Bool
Ord x =&gt; x -&gt; x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | @as `longerThan` n@ is properly lazy version of @length as &gt; n@</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- (doesn't stuck on infinite list etc.)</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- &gt;&gt;&gt; longerThan &quot;abc&quot; &lt;$&gt; [1,2,3,4]</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- [False,False,True,True]</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- &gt;&gt;&gt; longerThan (repeat 'a') &lt;$&gt; [1,2,3,4]</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- [False,False,False,False]</span><span>
</span><span id="line-184"></span><span id="local-6989586621679137474"><span class="annot"><a href="ModelFinder.Solver.html#longerThan"><span class="hs-identifier hs-type">longerThan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679137474"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-185"></span><span id="longerThan"><span class="annot"><span class="annottext">longerThan :: forall a. [a] -&gt; Int -&gt; Bool
</span><a href="ModelFinder.Solver.html#longerThan"><span class="hs-identifier hs-var hs-var">longerThan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (Int -&gt; Bool) -&gt; Int -&gt; Bool)
-&gt; (Int -&gt; Bool) -&gt; [a] -&gt; Int -&gt; Bool
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679138017"><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679138017"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679138018"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138018"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138018"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621679138017"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138018"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">-- | @anyWithLimit n p as@ is @any pred as@ but &quot;gives up&quot; on list of length more than</span><span>
</span><span id="line-188"></span><span class="hs-comment">--   @n@, by defaulting to @True@.</span><span>
</span><span id="line-189"></span><span id="local-6989586621679137483"><span class="annot"><a href="ModelFinder.Solver.html#anyWithLimit"><span class="hs-identifier hs-type">anyWithLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679137483"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679137483"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-190"></span><span id="anyWithLimit"><span class="annot"><span class="annottext">anyWithLimit :: forall a. Int -&gt; (a -&gt; Bool) -&gt; [a] -&gt; Bool
</span><a href="ModelFinder.Solver.html#anyWithLimit"><span class="hs-identifier hs-var hs-var">anyWithLimit</span></a></span></span><span> </span><span id="local-6989586621679138023"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138023"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621679138024"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679138024"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679138025"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679138025"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679138024"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; [a] -&gt; [Bool]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [a] -&gt; [a]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138023"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679138025"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; [Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="ModelFinder.Solver.html#bruteforceSolve"><span class="hs-identifier hs-type">bruteforceSolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137546"><span class="annot"><a href="#local-6989586621679137546"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137547"><span class="annot"><a href="#local-6989586621679137547"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137546"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137546"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137547"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137546"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679137547"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137546"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137546"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-193"></span><span id="bruteforceSolve"><span class="annot"><span class="annottext">bruteforceSolve :: forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
Model f -&gt; Map k (Property f) -&gt; [Model f]
</span><a href="ModelFinder.Solver.html#bruteforceSolve"><span class="hs-identifier hs-var hs-var">bruteforceSolve</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span id="local-6989586621679138041"><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679138041"><span class="hs-identifier hs-var">model</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679138042"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138042"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DMap f Identity -&gt; Model f
forall {f :: * -&gt; *}. DMap f Identity -&gt; Model f
</span><a href="#local-6989586621679138043"><span class="hs-identifier hs-var">solutionToModel</span></a></span><span> </span><span class="annot"><span class="annottext">(DMap f Identity -&gt; Model f) -&gt; [DMap f Identity] -&gt; [Model f]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(DMap f Identity -&gt; Bool) -&gt; [DMap f Identity] -&gt; [DMap f Identity]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">DMap f Identity -&gt; Bool
</span><a href="#local-6989586621679138044"><span class="hs-identifier hs-var">validSolution</span></a></span><span> </span><span class="annot"><span class="annottext">[DMap f Identity]
</span><a href="#local-6989586621679138045"><span class="hs-identifier hs-var">solutions</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679138045"><span class="annot"><span class="annottext">solutions :: [DMap f Identity]
</span><a href="#local-6989586621679138045"><span class="hs-identifier hs-var hs-var">solutions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DSum f Identity] -&gt; DMap f Identity
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *).
[DSum k2 f] -&gt; DMap k2 f
</span><span class="hs-identifier hs-var">DMap.fromDistinctAscList</span></span><span> </span><span class="annot"><span class="annottext">([DSum f Identity] -&gt; DMap f Identity)
-&gt; [[DSum f Identity]] -&gt; [DMap f Identity]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(DSum f Set -&gt; [DSum f Identity])
-&gt; [DSum f Set] -&gt; [[DSum f Identity]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">DSum f Set -&gt; [DSum f Identity]
forall {tag :: * -&gt; *}. DSum tag Set -&gt; [DSum tag Identity]
</span><a href="#local-6989586621679138048"><span class="hs-identifier hs-var">dsumToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DMap f Set -&gt; [DSum f Set]
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *).
DMap k2 f -&gt; [DSum k2 f]
</span><span class="hs-identifier hs-var">DMap.toAscList</span></span><span> </span><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679138041"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679138048"><span class="annot"><span class="annottext">dsumToList :: DSum tag Set -&gt; [DSum tag Identity]
</span><a href="#local-6989586621679138048"><span class="hs-identifier hs-var hs-var">dsumToList</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138050"><span class="annot"><span class="annottext">tag a
</span><a href="#local-6989586621679138050"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=&gt;</span></span><span> </span><span id="local-6989586621679138051"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138051"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">tag a
</span><a href="#local-6989586621679138050"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">tag a -&gt; Identity a -&gt; DSum tag Identity
forall {k} (tag :: k -&gt; *) (f :: k -&gt; *) (a :: k).
tag a -&gt; f a -&gt; DSum tag f
</span><span class="hs-operator hs-var">:=&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Identity a
forall a. a -&gt; Identity a
</span><span class="hs-identifier hs-var">Identity</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679138052"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679138052"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679138052"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138051"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679138044"><span class="annot"><span class="annottext">validSolution :: DMap f Identity -&gt; Bool
</span><a href="#local-6989586621679138044"><span class="hs-identifier hs-var hs-var">validSolution</span></a></span></span><span> </span><span id="local-6989586621679138053"><span class="annot"><span class="annottext">DMap f Identity
</span><a href="#local-6989586621679138053"><span class="hs-identifier hs-var">sol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Property f -&gt; Bool) -&gt; Map k (Property f) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679138055"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138055"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DMap f Identity -&gt; Property f -&gt; Bool
forall {f :: * -&gt; *}.
(Has Ord f, GCompare f) =&gt;
DMap f Identity -&gt; Property f -&gt; Bool
</span><a href="#local-6989586621679138056"><span class="hs-identifier hs-var">reduceBySol</span></a></span><span> </span><span class="annot"><span class="annottext">DMap f Identity
</span><a href="#local-6989586621679138053"><span class="hs-identifier hs-var">sol</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138055"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138042"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679138056"><span class="annot"><span class="annottext">reduceBySol :: DMap f Identity -&gt; Property f -&gt; Bool
</span><a href="#local-6989586621679138056"><span class="hs-identifier hs-var hs-var">reduceBySol</span></a></span></span><span> </span><span id="local-6989586621679138062"><span class="annot"><span class="annottext">DMap f Identity
</span><a href="#local-6989586621679138062"><span class="hs-identifier hs-var">sol</span></a></span></span><span> </span><span id="local-6989586621679138063"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138063"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; Maybe x) -&gt; Property f -&gt; (IsChanged, Property f)
forall (f :: * -&gt; *).
Has Ord f =&gt;
(forall x. f x -&gt; Maybe x) -&gt; Property f -&gt; (IsChanged, Property f)
</span><a href="ModelFinder.Solver.html#reducePropertyOrd"><span class="hs-identifier hs-var">reducePropertyOrd</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679138067"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138067"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Identity x -&gt; x
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity x -&gt; x) -&gt; Maybe (Identity x) -&gt; Maybe x
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f x -&gt; DMap f Identity -&gt; Maybe (Identity x)
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *) (v :: k1).
GCompare k2 =&gt;
k2 v -&gt; DMap k2 f -&gt; Maybe (f v)
</span><span class="hs-identifier hs-var">DMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138067"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">DMap f Identity
</span><a href="#local-6989586621679138062"><span class="hs-identifier hs-var">sol</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138063"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-199"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#PropBool"><span class="hs-identifier hs-type">PropBool</span></a></span><span> </span><span id="local-6989586621679138069"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138069"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679138069"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">(IsChanged, Property f)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621679138043"><span class="annot"><span class="annottext">solutionToModel :: DMap f Identity -&gt; Model f
</span><a href="#local-6989586621679138043"><span class="hs-identifier hs-var hs-var">solutionToModel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DMap f Set -&gt; Model f
forall (f :: * -&gt; *). DMap f Set -&gt; Model f
</span><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-var">Model</span></a></span><span> </span><span class="annot"><span class="annottext">(DMap f Set -&gt; Model f)
-&gt; (DMap f Identity -&gt; DMap f Set) -&gt; DMap f Identity -&gt; Model f
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall v. Identity v -&gt; Set v) -&gt; DMap f Identity -&gt; DMap f Set
forall {k1} (f :: k1 -&gt; *) (g :: k1 -&gt; *) (k2 :: k1 -&gt; *).
(forall (v :: k1). f v -&gt; g v) -&gt; DMap k2 f -&gt; DMap k2 g
</span><span class="hs-identifier hs-var">DMap.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Set v
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; Set v) -&gt; (Identity v -&gt; v) -&gt; Identity v -&gt; Set v
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity v -&gt; v
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">data</span><span> </span><span id="SolverState"><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span></span><span> </span><span id="local-6989586621679137579"><span class="annot"><a href="#local-6989586621679137579"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137580"><span class="annot"><a href="#local-6989586621679137580"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SolverState"><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137579"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-type">Blocker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137579"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137580"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679137580"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137579"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="ModelFinder.Solver.html#solve"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137569"><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137570"><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span id="solve"><span class="annot"><span class="annottext">solve :: forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
Int -&gt; Model f -&gt; Map k (Property f) -&gt; [Model f]
</span><a href="ModelFinder.Solver.html#solve"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621679138102"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138102"><span class="hs-identifier hs-var">limit</span></a></span></span><span> </span><span id="local-6989586621679138103"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138103"><span class="hs-identifier hs-var">initialModel</span></a></span></span><span> </span><span id="local-6989586621679138104"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138104"><span class="hs-identifier hs-var">exprs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k) -&gt; [SolverState f k]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138105"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138106"><span class="hs-identifier hs-var">initialState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k (Property f) -&gt; [k]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138104"><span class="hs-identifier hs-var">exprs0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SolverState f k] -&gt; (SolverState f k -&gt; [Model f]) -&gt; [Model f]
forall a b. [a] -&gt; (a -&gt; [b]) -&gt; [b]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [Model f]
</span><a href="#local-6989586621679138108"><span class="hs-identifier hs-var">solveLoop</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679138109"><span class="annot"><span class="annottext">initialBlockers :: Blocker f k
</span><a href="#local-6989586621679138109"><span class="hs-identifier hs-var hs-var">initialBlockers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Blocker f k -&gt; Blocker f k -&gt; Blocker f k)
-&gt; Blocker f k -&gt; [Blocker f k] -&gt; Blocker f k
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">Data.List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Blocker f k -&gt; Blocker f k -&gt; Blocker f k
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Blocker f k
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(k, Property f) -&gt; Blocker f k
forall (f :: * -&gt; *) k.
(GCompare f, Ord k) =&gt;
(k, Property f) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#singleBlocker"><span class="hs-identifier hs-var">singleBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">((k, Property f) -&gt; Blocker f k)
-&gt; [(k, Property f)] -&gt; [Blocker f k]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f) -&gt; [(k, Property f)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138104"><span class="hs-identifier hs-var">exprs0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621679138106"><span class="annot"><span class="annottext">initialState :: SolverState f k
</span><a href="#local-6989586621679138106"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138103"><span class="hs-identifier hs-var">initialModel</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138109"><span class="hs-identifier hs-var">initialBlockers</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138104"><span class="hs-identifier hs-var">exprs0</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="#local-6989586621679138108"><span class="hs-identifier hs-type">solveLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679138108"><span class="annot"><span class="annottext">solveLoop :: SolverState f k -&gt; [Model f]
</span><a href="#local-6989586621679138108"><span class="hs-identifier hs-var hs-var">solveLoop</span></a></span></span><span> </span><span id="local-6989586621679138110"><span class="annot"><span class="annottext">state :: SolverState f k
</span><a href="#local-6989586621679138110"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138111"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138111"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138112"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138112"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocker f k -&gt; Maybe (Some f)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Maybe (Some f)
</span><a href="ModelFinder.Solver.html#mostWanted"><span class="hs-identifier hs-var">mostWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138112"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Some f)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138111"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span id="local-6989586621679138125"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138125"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621679138126"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679138126"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Model f -&gt; f a -&gt; [a]
forall (f :: * -&gt; *) x. GCompare f =&gt; Model f -&gt; f x -&gt; [x]
</span><a href="ModelFinder.Solver.html#guess"><span class="hs-identifier hs-var">guess</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138111"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138125"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679138127"><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138127"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138128"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138128"><span class="hs-identifier hs-var">state'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Set k, SolverState f k) -&gt; [(Set k, SolverState f k)]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SolverState f k -&gt; f a -&gt; a -&gt; Maybe (Set k, SolverState f k)
forall (f :: * -&gt; *) k x.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; f x -&gt; x -&gt; Maybe (Set k, SolverState f k)
</span><a href="ModelFinder.Solver.html#enter"><span class="hs-identifier hs-var">enter</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138110"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138125"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679138126"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span id="local-6989586621679138130"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138130"><span class="hs-identifier hs-var">state''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k) -&gt; [SolverState f k]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (SolverState f k) -&gt; [SolverState f k])
-&gt; Maybe (SolverState f k) -&gt; [SolverState f k]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138105"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138128"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k -&gt; [k]
forall a. Set a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138127"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">SolverState f k -&gt; [Model f]
</span><a href="#local-6989586621679138108"><span class="hs-identifier hs-var">solveLoop</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138130"><span class="hs-identifier hs-var">state''</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="#local-6989586621679138105"><span class="hs-identifier hs-type">visitExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137569"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137570"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621679138105"><span class="annot"><span class="annottext">visitExprs :: SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138105"><span class="hs-identifier hs-var hs-var">visitExprs</span></a></span></span><span> </span><span id="local-6989586621679138131"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138131"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; Maybe (SolverState f k)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138131"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="#local-6989586621679138105"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span id="local-6989586621679138132"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138132"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138133"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138133"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679138134"><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679138134"><span class="hs-identifier hs-var">exprStack</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; k -&gt; Maybe (SolverState f k, Property f)
forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; k -&gt; Maybe (SolverState f k, Property f)
</span><a href="ModelFinder.Solver.html#reducePropertyAt"><span class="hs-identifier hs-var">reducePropertyAt</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138132"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138133"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SolverState f k, Property f)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138105"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138132"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679138134"><span class="hs-identifier hs-var">exprStack</span></a></span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138136"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138136"><span class="hs-identifier hs-var">state'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138137"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138137"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679138138"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138138"><span class="hs-identifier hs-var">state''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138139"><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138139"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SolverState f k
-&gt; k -&gt; Property f -&gt; Maybe (SolverState f k, [DSum f Set])
</span><a href="#local-6989586621679138140"><span class="hs-identifier hs-var">refineState</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138136"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138133"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138137"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-227"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679138141"><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138141"><span class="hs-identifier hs-var">notifiedExprs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138142"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138142"><span class="hs-identifier hs-var">state'''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [DSum f Set] -&gt; Maybe (Set k, SolverState f k)
forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; [DSum f Set] -&gt; Maybe (Set k, SolverState f k)
</span><a href="ModelFinder.Solver.html#tightenState"><span class="hs-identifier hs-var">tightenState</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138138"><span class="hs-identifier hs-var">state''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DSum f Set -&gt; Int) -&gt; [DSum f Set] -&gt; [DSum f Set]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">DSum f Set -&gt; Int
forall {tag :: * -&gt; *}. DSum tag Set -&gt; Int
</span><a href="#local-6989586621679138144"><span class="hs-identifier hs-var">newSetSize</span></a></span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138139"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>          </span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138105"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138142"><span class="hs-identifier hs-var">state'''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k -&gt; [k]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138141"><span class="hs-identifier hs-var">notifiedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">[k] -&gt; [k] -&gt; [k]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679138134"><span class="hs-identifier hs-var">exprStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621679138140"><span class="annot"><span class="annottext">refineState :: SolverState f k
-&gt; k -&gt; Property f -&gt; Maybe (SolverState f k, [DSum f Set])
</span><a href="#local-6989586621679138140"><span class="hs-identifier hs-var hs-var">refineState</span></a></span></span><span> </span><span id="local-6989586621679138145"><span class="annot"><span class="annottext">state :: SolverState f k
</span><a href="#local-6989586621679138145"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138146"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138146"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138147"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138147"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621679138148"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138148"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679138149"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138149"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679138150"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138150"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138150"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><a href="ModelFinder.Expr.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span id="local-6989586621679138151"><span class="annot"><span class="annottext">SimpleProp f
</span><a href="#local-6989586621679138151"><span class="hs-identifier hs-var">sprop</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Model f -&gt; SimpleProp f -&gt; Maybe (IsDeleted, [DSum f Set])
forall (f :: * -&gt; *).
(GCompare f, Has Ord f) =&gt;
Model f -&gt; SimpleProp f -&gt; Maybe (IsDeleted, [DSum f Set])
</span><a href="ModelFinder.Solver.html#refineSimple"><span class="hs-identifier hs-var">refineSimple</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138146"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleProp f
</span><a href="#local-6989586621679138151"><span class="hs-identifier hs-var">sprop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">Maybe (IsDeleted, [DSum f Set])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k, [DSum f Set])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsDeleted
</span><a href="ModelFinder.Solver.html#DeleteIt"><span class="hs-identifier hs-var">DeleteIt</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138152"><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138152"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138153"><span class="annot"><span class="annottext">exprs' :: Map k (Property f)
</span><a href="#local-6989586621679138153"><span class="hs-identifier hs-var hs-var">exprs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k (Property f) -&gt; Map k (Property f)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138149"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138148"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-236"></span><span>                </span><span id="local-6989586621679138155"><span class="annot"><span class="annottext">blocker' :: Blocker f k
</span><a href="#local-6989586621679138155"><span class="hs-identifier hs-var hs-var">blocker'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Set (Some f) -&gt; Set (Some f) -&gt; Blocker f k -&gt; Blocker f k
forall (f :: * -&gt; *) k.
(GCompare f, Ord k) =&gt;
k -&gt; Set (Some f) -&gt; Set (Some f) -&gt; Blocker f k -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#updateBlocker"><span class="hs-identifier hs-var">updateBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138149"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Property f -&gt; Set (Some f)
forall (f :: * -&gt; *). GCompare f =&gt; Property f -&gt; Set (Some f)
</span><a href="ModelFinder.Solver.html#demandSet"><span class="hs-identifier hs-var">demandSet</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138150"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Some f)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138147"><span class="hs-identifier hs-var">blocker</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(SolverState f k, [DSum f Set])
-&gt; Maybe (SolverState f k, [DSum f Set])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138146"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138155"><span class="hs-identifier hs-var">blocker'</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138153"><span class="hs-identifier hs-var">exprs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138152"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsDeleted
</span><a href="ModelFinder.Solver.html#KeepIt"><span class="hs-identifier hs-var">KeepIt</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138156"><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138156"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SolverState f k, [DSum f Set])
-&gt; Maybe (SolverState f k, [DSum f Set])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138145"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138156"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><a href="ModelFinder.Expr.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621679138158"><span class="annot"><span class="annottext">f (SimpleProp f)
</span><a href="#local-6989586621679138158"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Model f
-&gt; Requests f (SimpleProp f)
-&gt; (SimpleProp f -&gt; Property f)
-&gt; Maybe [DSum f Set]
forall (f :: * -&gt; *) xs.
(GCompare f, Has Ord f) =&gt;
Int
-&gt; Model f
-&gt; Requests f xs
-&gt; (xs -&gt; Property f)
-&gt; Maybe [DSum f Set]
</span><a href="ModelFinder.Solver.html#refineComplex"><span class="hs-identifier hs-var">refineComplex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138102"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138146"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (SimpleProp f) -&gt; Requests f (SimpleProp f)
forall (f :: * -&gt; *) v. f v -&gt; Requests f v
</span><a href="ModelFinder.Expr.html#Request"><span class="hs-identifier hs-var">Request</span></a></span><span> </span><span class="annot"><span class="annottext">f (SimpleProp f)
</span><a href="#local-6989586621679138158"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SimpleProp f -&gt; Property f
forall a (f :: * -&gt; *). a -&gt; Expr f a
</span><a href="ModelFinder.Expr.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [DSum f Set]
-&gt; ([DSum f Set] -&gt; Maybe (SolverState f k, [DSum f Set]))
-&gt; Maybe (SolverState f k, [DSum f Set])
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679138160"><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138160"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SolverState f k, [DSum f Set])
-&gt; Maybe (SolverState f k, [DSum f Set])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138145"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138160"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><a href="ModelFinder.Expr.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span id="local-6989586621679138165"><span class="annot"><span class="annottext">Requests f v
</span><a href="#local-6989586621679138165"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679138166"><span class="annot"><span class="annottext">v -&gt; Property f
</span><a href="#local-6989586621679138166"><span class="hs-identifier hs-var">kx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Model f
-&gt; Requests f v
-&gt; (v -&gt; Property f)
-&gt; Maybe [DSum f Set]
forall (f :: * -&gt; *) xs.
(GCompare f, Has Ord f) =&gt;
Int
-&gt; Model f
-&gt; Requests f xs
-&gt; (xs -&gt; Property f)
-&gt; Maybe [DSum f Set]
</span><a href="ModelFinder.Solver.html#refineComplex"><span class="hs-identifier hs-var">refineComplex</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138102"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138146"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Requests f v
</span><a href="#local-6989586621679138165"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Property f
</span><a href="#local-6989586621679138166"><span class="hs-identifier hs-var">kx</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [DSum f Set]
-&gt; ([DSum f Set] -&gt; Maybe (SolverState f k, [DSum f Set]))
-&gt; Maybe (SolverState f k, [DSum f Set])
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679138167"><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138167"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SolverState f k, [DSum f Set])
-&gt; Maybe (SolverState f k, [DSum f Set])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138145"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138167"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679138144"><span class="annot"><span class="annottext">newSetSize :: DSum tag Set -&gt; Int
</span><a href="#local-6989586621679138144"><span class="hs-identifier hs-var hs-var">newSetSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=&gt;</span></span><span> </span><span id="local-6989586621679138168"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138168"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138168"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><a href="ModelFinder.Solver.html#enter"><span class="hs-identifier hs-type">enter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679137582"><span class="annot"><a href="#local-6989586621679137582"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679137583"><span class="annot"><a href="#local-6989586621679137583"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621679137584"><span class="annot"><a href="#local-6989586621679137584"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137582"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137582"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137583"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137582"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137583"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137582"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137584"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137584"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679137583"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137582"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137583"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span id="enter"><span class="annot"><span class="annottext">enter :: forall (f :: * -&gt; *) k x.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; f x -&gt; x -&gt; Maybe (Set k, SolverState f k)
</span><a href="ModelFinder.Solver.html#enter"><span class="hs-identifier hs-var hs-var">enter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138178"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138178"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138179"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138179"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621679138180"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138180"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679138181"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138181"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679138182"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679138182"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138183"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138183"><span class="hs-identifier hs-var">model'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">f x -&gt; Set x -&gt; Model f -&gt; Maybe (IsChanged, Model f)
forall (f :: * -&gt; *) x.
(GCompare f, Has Ord f) =&gt;
f x -&gt; Set x -&gt; Model f -&gt; Maybe (IsChanged, Model f)
</span><a href="ModelFinder.Solver.html#tighten"><span class="hs-identifier hs-var">tighten</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138181"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x -&gt; Set x
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679138182"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138178"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138184"><span class="annot"><span class="annottext">notifiedExprs :: Set k
</span><a href="#local-6989586621679138184"><span class="hs-identifier hs-var hs-var">notifiedExprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set k -&gt; Some f -&gt; Map (Some f) (Set k) -&gt; Set k
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Set k
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Some f
forall {k} (tag :: k -&gt; *) (a :: k). tag a -&gt; Some tag
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138181"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker f k -&gt; Map (Some f) (Set k)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Map (Some f) (Set k)
</span><a href="ModelFinder.Solver.html#getBlockerMap"><span class="hs-identifier hs-var">getBlockerMap</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138179"><span class="hs-identifier hs-var">blocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>      </span><span id="local-6989586621679138186"><span class="annot"><span class="annottext">blocker' :: Blocker f k
</span><a href="#local-6989586621679138186"><span class="hs-identifier hs-var hs-var">blocker'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Blocker f k
forall (f :: * -&gt; *) k. Map (Some f) (Set k) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Some f) (Set k) -&gt; Blocker f k)
-&gt; Map (Some f) (Set k) -&gt; Blocker f k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Some f -&gt; Map (Some f) (Set k) -&gt; Map (Some f) (Set k)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Some f
forall {k} (tag :: k -&gt; *) (a :: k). tag a -&gt; Some tag
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138181"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker f k -&gt; Map (Some f) (Set k)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Map (Some f) (Set k)
</span><a href="ModelFinder.Solver.html#getBlockerMap"><span class="hs-identifier hs-var">getBlockerMap</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138179"><span class="hs-identifier hs-var">blocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="annottext">(Set k, SolverState f k) -&gt; Maybe (Set k, SolverState f k)
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138184"><span class="hs-identifier hs-var">notifiedExprs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138183"><span class="hs-identifier hs-var">model'</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138186"><span class="hs-identifier hs-var">blocker'</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138180"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span id="local-6989586621679137587"><span id="local-6989586621679137588"><span class="annot"><a href="ModelFinder.Solver.html#tightenState"><span class="hs-identifier hs-type">tightenState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137587"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137587"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137588"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137587"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137588"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">DSum</span></span><span> </span><span class="annot"><a href="#local-6989586621679137587"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679137588"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137587"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137588"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-252"></span><span id="tightenState"><span class="annot"><span class="annottext">tightenState :: forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; [DSum f Set] -&gt; Maybe (Set k, SolverState f k)
</span><a href="ModelFinder.Solver.html#tightenState"><span class="hs-identifier hs-var hs-var">tightenState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set k
-&gt; SolverState f k
-&gt; [DSum f Set]
-&gt; Maybe (Set k, SolverState f k)
forall {f :: * -&gt; *} {k}.
(GCompare f, Has Ord f, Ord k) =&gt;
Set k
-&gt; SolverState f k
-&gt; [DSum f Set]
-&gt; Maybe (Set k, SolverState f k)
</span><a href="#local-6989586621679138193"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set k
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679138193"><span class="annot"><span class="annottext">go :: Set k
-&gt; SolverState f k
-&gt; [DSum f Set]
-&gt; Maybe (Set k, SolverState f k)
</span><a href="#local-6989586621679138193"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679138199"><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138199"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679138200"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138200"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set k, SolverState f k) -&gt; Maybe (Set k, SolverState f k)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138199"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138200"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><a href="#local-6989586621679138193"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679138201"><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138201"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679138202"><span class="annot"><span class="annottext">state :: SolverState f k
</span><a href="#local-6989586621679138202"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138203"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138203"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138204"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138204"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621679138205"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138205"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679138216"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138216"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=&gt;</span></span><span> </span><span id="local-6989586621679138217"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138217"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679138218"><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138218"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">f a -&gt; Set a -&gt; Model f -&gt; Maybe (IsChanged, Model f)
forall (f :: * -&gt; *) x.
(GCompare f, Has Ord f) =&gt;
f x -&gt; Set x -&gt; Model f -&gt; Maybe (IsChanged, Model f)
</span><a href="ModelFinder.Solver.html#tighten"><span class="hs-identifier hs-var">tighten</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138216"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138217"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138203"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">Maybe (IsChanged, Model f)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Set k, SolverState f k)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><a href="ModelFinder.Expr.html#NoChange"><span class="hs-identifier hs-var">NoChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Model f
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138217"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set k
-&gt; SolverState f k
-&gt; [DSum f Set]
-&gt; Maybe (Set k, SolverState f k)
</span><a href="#local-6989586621679138193"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138201"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138202"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138218"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138219"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138219"><span class="hs-identifier hs-var">model'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-260"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138220"><span class="annot"><span class="annottext">notifiedExprs :: Set k
</span><a href="#local-6989586621679138220"><span class="hs-identifier hs-var hs-var">notifiedExprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set k -&gt; Some f -&gt; Map (Some f) (Set k) -&gt; Set k
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Set k
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f a -&gt; Some f
forall {k} (tag :: k -&gt; *) (a :: k). tag a -&gt; Some tag
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138216"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker f k -&gt; Map (Some f) (Set k)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Map (Some f) (Set k)
</span><a href="ModelFinder.Solver.html#getBlockerMap"><span class="hs-identifier hs-var">getBlockerMap</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138204"><span class="hs-identifier hs-var">blocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>              </span><span id="local-6989586621679138221"><span class="annot"><span class="annottext">blocker' :: Blocker f k
</span><a href="#local-6989586621679138221"><span class="hs-identifier hs-var hs-var">blocker'</span></a></span></span><span>
</span><span id="line-262"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f a -&gt; Model f -&gt; Maybe a
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Maybe x
</span><a href="ModelFinder.Solver.html#lookupKnown"><span class="hs-identifier hs-var">lookupKnown</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138216"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138219"><span class="hs-identifier hs-var">model'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Some f) (Set k) -&gt; Blocker f k
forall (f :: * -&gt; *) k. Map (Some f) (Set k) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#Blocker"><span class="hs-identifier hs-var">Blocker</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Some f) (Set k) -&gt; Blocker f k)
-&gt; Map (Some f) (Set k) -&gt; Blocker f k
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Some f -&gt; Map (Some f) (Set k) -&gt; Map (Some f) (Set k)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f a -&gt; Some f
forall {k} (tag :: k -&gt; *) (a :: k). tag a -&gt; Some tag
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138216"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blocker f k -&gt; Map (Some f) (Set k)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Map (Some f) (Set k)
</span><a href="ModelFinder.Solver.html#getBlockerMap"><span class="hs-identifier hs-var">getBlockerMap</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138204"><span class="hs-identifier hs-var">blocker</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138204"><span class="hs-identifier hs-var">blocker</span></a></span><span>
</span><span id="line-264"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set k
-&gt; SolverState f k
-&gt; [DSum f Set]
-&gt; Maybe (Set k, SolverState f k)
</span><a href="#local-6989586621679138193"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k -&gt; Set k -&gt; Set k
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138220"><span class="hs-identifier hs-var">notifiedExprs</span></a></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138201"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138219"><span class="hs-identifier hs-var">model'</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138221"><span class="hs-identifier hs-var">blocker'</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138205"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DSum f Set]
</span><a href="#local-6989586621679138218"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span id="local-6989586621679137585"><span id="local-6989586621679137586"><span class="annot"><a href="ModelFinder.Solver.html#reducePropertyAt"><span class="hs-identifier hs-type">reducePropertyAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679137585"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137585"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679137586"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137585"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137586"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679137586"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137585"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137586"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137585"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-267"></span><span id="reducePropertyAt"><span class="annot"><span class="annottext">reducePropertyAt :: forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; k -&gt; Maybe (SolverState f k, Property f)
</span><a href="ModelFinder.Solver.html#reducePropertyAt"><span class="hs-identifier hs-var hs-var">reducePropertyAt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138233"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138233"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138234"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138234"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621679138235"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138235"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679138236"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138236"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>  </span><span id="local-6989586621679138237"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138237"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k (Property f) -&gt; Maybe (Property f)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138236"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138235"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; Maybe x) -&gt; Property f -&gt; (IsChanged, Property f)
forall (f :: * -&gt; *).
Has Ord f =&gt;
(forall x. f x -&gt; Maybe x) -&gt; Property f -&gt; (IsChanged, Property f)
</span><a href="ModelFinder.Solver.html#reducePropertyOrd"><span class="hs-identifier hs-var">reducePropertyOrd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f x -&gt; Model f -&gt; Maybe x
forall (f :: * -&gt; *) x. GCompare f =&gt; f x -&gt; Model f -&gt; Maybe x
</span><a href="ModelFinder.Solver.html#lookupKnown"><span class="hs-operator hs-var">`lookupKnown`</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138233"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138237"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><a href="ModelFinder.Expr.html#NoChange"><span class="hs-identifier hs-var">NoChange</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Property f
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k, Property f)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsChanged
</span><a href="ModelFinder.Expr.html#Changed"><span class="hs-identifier hs-var">Changed</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138240"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138240"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679138241"><span class="annot"><span class="annottext">exprs' :: Map k (Property f)
</span><a href="#local-6989586621679138241"><span class="hs-identifier hs-var hs-var">exprs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Property f -&gt; Map k (Property f) -&gt; Map k (Property f)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138236"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138240"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138235"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-273"></span><span>          </span><span id="local-6989586621679138243"><span class="annot"><span class="annottext">blocker' :: Blocker f k
</span><a href="#local-6989586621679138243"><span class="hs-identifier hs-var hs-var">blocker'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">k -&gt; Set (Some f) -&gt; Set (Some f) -&gt; Blocker f k -&gt; Blocker f k
forall (f :: * -&gt; *) k.
(GCompare f, Ord k) =&gt;
k -&gt; Set (Some f) -&gt; Set (Some f) -&gt; Blocker f k -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#updateBlocker"><span class="hs-identifier hs-var">updateBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138236"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Property f -&gt; Set (Some f)
forall (f :: * -&gt; *). GCompare f =&gt; Property f -&gt; Set (Some f)
</span><a href="ModelFinder.Solver.html#demandSet"><span class="hs-identifier hs-var">demandSet</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138237"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Property f -&gt; Set (Some f)
forall (f :: * -&gt; *). GCompare f =&gt; Property f -&gt; Set (Some f)
</span><a href="ModelFinder.Solver.html#demandSet"><span class="hs-identifier hs-var">demandSet</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138240"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138234"><span class="hs-identifier hs-var">blocker</span></a></span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(SolverState f k, Property f)
-&gt; Maybe (SolverState f k, Property f)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138233"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138243"><span class="hs-identifier hs-var">blocker'</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138241"><span class="hs-identifier hs-var">exprs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138240"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="annot"><a href="ModelFinder.Solver.html#solveNoRefine"><span class="hs-identifier hs-type">solveNoRefine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679138244"><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679138245"><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GCompare</span></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#Property"><span class="hs-identifier hs-type">Property</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span id="solveNoRefine"><span class="annot"><span class="annottext">solveNoRefine :: forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
Model f -&gt; Map k (Property f) -&gt; [Model f]
</span><a href="ModelFinder.Solver.html#solveNoRefine"><span class="hs-identifier hs-var hs-var">solveNoRefine</span></a></span></span><span> </span><span id="local-6989586621679138262"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138262"><span class="hs-identifier hs-var">initialModel</span></a></span></span><span> </span><span id="local-6989586621679138263"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138263"><span class="hs-identifier hs-var">exprs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k) -&gt; [SolverState f k]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138264"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138265"><span class="hs-identifier hs-var">initialState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k (Property f) -&gt; [k]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138263"><span class="hs-identifier hs-var">exprs0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SolverState f k] -&gt; (SolverState f k -&gt; [Model f]) -&gt; [Model f]
forall a b. [a] -&gt; (a -&gt; [b]) -&gt; [b]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [Model f]
</span><a href="#local-6989586621679138266"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621679138267"><span class="annot"><span class="annottext">initialBlockers :: Blocker f k
</span><a href="#local-6989586621679138267"><span class="hs-identifier hs-var hs-var">initialBlockers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Blocker f k -&gt; Blocker f k -&gt; Blocker f k)
-&gt; Blocker f k -&gt; [Blocker f k] -&gt; Blocker f k
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">Data.List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Blocker f k -&gt; Blocker f k -&gt; Blocker f k
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">Blocker f k
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(k, Property f) -&gt; Blocker f k
forall (f :: * -&gt; *) k.
(GCompare f, Ord k) =&gt;
(k, Property f) -&gt; Blocker f k
</span><a href="ModelFinder.Solver.html#singleBlocker"><span class="hs-identifier hs-var">singleBlocker</span></a></span><span> </span><span class="annot"><span class="annottext">((k, Property f) -&gt; Blocker f k)
-&gt; [(k, Property f)] -&gt; [Blocker f k]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f) -&gt; [(k, Property f)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138263"><span class="hs-identifier hs-var">exprs0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679138265"><span class="annot"><span class="annottext">initialState :: SolverState f k
</span><a href="#local-6989586621679138265"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138262"><span class="hs-identifier hs-var">initialModel</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138267"><span class="hs-identifier hs-var">initialBlockers</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138263"><span class="hs-identifier hs-var">exprs0</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621679138266"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679138266"><span class="annot"><span class="annottext">go :: SolverState f k -&gt; [Model f]
</span><a href="#local-6989586621679138266"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679138268"><span class="annot"><span class="annottext">state :: SolverState f k
</span><a href="#local-6989586621679138268"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138269"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138269"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138270"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138270"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Blocker f k -&gt; Maybe (Some f)
forall (f :: * -&gt; *) k. Blocker f k -&gt; Maybe (Some f)
</span><a href="ModelFinder.Solver.html#mostWanted"><span class="hs-identifier hs-var">mostWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138270"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Some f)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138269"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span id="local-6989586621679138280"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138280"><span class="hs-identifier hs-var">fx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621679138281"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679138281"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Model f -&gt; f a -&gt; [a]
forall (f :: * -&gt; *) x. GCompare f =&gt; Model f -&gt; f x -&gt; [x]
</span><a href="ModelFinder.Solver.html#guess"><span class="hs-identifier hs-var">guess</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138269"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138280"><span class="hs-identifier hs-var">fx</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679138282"><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138282"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138283"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138283"><span class="hs-identifier hs-var">state'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Set k, SolverState f k) -&gt; [(Set k, SolverState f k)]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set k, SolverState f k) -&gt; [(Set k, SolverState f k)])
-&gt; Maybe (Set k, SolverState f k) -&gt; [(Set k, SolverState f k)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; f a -&gt; a -&gt; Maybe (Set k, SolverState f k)
forall (f :: * -&gt; *) k x.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; f x -&gt; x -&gt; Maybe (Set k, SolverState f k)
</span><a href="ModelFinder.Solver.html#enter"><span class="hs-identifier hs-var">enter</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138268"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138280"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679138281"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621679138284"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138284"><span class="hs-identifier hs-var">state''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k) -&gt; [SolverState f k]
forall a. Maybe a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (SolverState f k) -&gt; [SolverState f k])
-&gt; Maybe (SolverState f k) -&gt; [SolverState f k]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138264"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138283"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set k -&gt; [k]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set k
</span><a href="#local-6989586621679138282"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">SolverState f k -&gt; [Model f]
</span><a href="#local-6989586621679138266"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138284"><span class="hs-identifier hs-var">state''</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="#local-6989586621679138264"><span class="hs-identifier hs-type">visitExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138244"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138245"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621679138264"><span class="annot"><span class="annottext">visitExprs :: SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138264"><span class="hs-identifier hs-var hs-var">visitExprs</span></a></span></span><span> </span><span id="local-6989586621679138285"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138285"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; Maybe (SolverState f k)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138285"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621679138264"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span id="local-6989586621679138286"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138286"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138287"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138287"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679138288"><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679138288"><span class="hs-identifier hs-var">exprStack</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; k -&gt; Maybe (SolverState f k, Property f)
forall (f :: * -&gt; *) k.
(GCompare f, Has Ord f, Ord k) =&gt;
SolverState f k -&gt; k -&gt; Maybe (SolverState f k, Property f)
</span><a href="ModelFinder.Solver.html#reducePropertyAt"><span class="hs-identifier hs-var">reducePropertyAt</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138286"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138287"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SolverState f k, Property f)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138264"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138286"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679138288"><span class="hs-identifier hs-var">exprStack</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138289"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138289"><span class="hs-identifier hs-var">state'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679138290"><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138290"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>          </span><span id="local-6989586621679138291"><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138291"><span class="hs-identifier hs-var">state''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; k -&gt; Property f -&gt; Maybe (SolverState f k)
forall {k} {f :: * -&gt; *} {f :: * -&gt; *} {f :: * -&gt; *}.
Ord k =&gt;
SolverState f k
-&gt; k -&gt; Expr f (SimpleProp f) -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138292"><span class="hs-identifier hs-var">refineState</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138289"><span class="hs-identifier hs-var">state'</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138287"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Property f
</span><a href="#local-6989586621679138290"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-298"></span><span>          </span><span class="annot"><span class="annottext">SolverState f k -&gt; [k] -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138264"><span class="hs-identifier hs-var">visitExprs</span></a></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138291"><span class="hs-identifier hs-var">state''</span></a></span><span> </span><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679138288"><span class="hs-identifier hs-var">exprStack</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621679138292"><span class="annot"><span class="annottext">refineState :: SolverState f k
-&gt; k -&gt; Expr f (SimpleProp f) -&gt; Maybe (SolverState f k)
</span><a href="#local-6989586621679138292"><span class="hs-identifier hs-var hs-var">refineState</span></a></span></span><span> </span><span id="local-6989586621679138297"><span class="annot"><span class="annottext">state :: SolverState f k
</span><a href="#local-6989586621679138297"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-type">SolverState</span></a></span><span> </span><span id="local-6989586621679138298"><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138298"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679138299"><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138299"><span class="hs-identifier hs-var">blocker</span></a></span></span><span> </span><span id="local-6989586621679138300"><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138300"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679138301"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138301"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679138302"><span class="annot"><span class="annottext">Expr f (SimpleProp f)
</span><a href="#local-6989586621679138302"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr f (SimpleProp f)
</span><a href="#local-6989586621679138302"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="ModelFinder.Expr.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#PropBool"><span class="hs-identifier hs-type">PropBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (SolverState f k)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><a href="ModelFinder.Expr.html#Pure"><span class="hs-identifier hs-type">Pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Expr.html#PropBool"><span class="hs-identifier hs-type">PropBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; Maybe (SolverState f k)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
forall (f :: * -&gt; *) k.
Model f -&gt; Blocker f k -&gt; Map k (Property f) -&gt; SolverState f k
</span><a href="ModelFinder.Solver.html#SolverState"><span class="hs-identifier hs-var">SolverState</span></a></span><span> </span><span class="annot"><span class="annottext">Model f
</span><a href="#local-6989586621679138298"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Blocker f k
</span><a href="#local-6989586621679138299"><span class="hs-identifier hs-var">blocker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; Map k (Property f) -&gt; Map k (Property f)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679138301"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Property f)
</span><a href="#local-6989586621679138300"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">Expr f (SimpleProp f)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SolverState f k -&gt; Maybe (SolverState f k)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SolverState f k
</span><a href="#local-6989586621679138297"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-keyword">data</span><span> </span><span id="Def"><span class="annot"><a href="ModelFinder.Solver.html#Def"><span class="hs-identifier hs-var">Def</span></a></span></span><span> </span><span id="local-6989586621679137644"><span class="annot"><a href="#local-6989586621679137644"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679138303"><span class="annot"><a href="#local-6989586621679138303"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679137644"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679138303"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span id="%3A%3D"><span class="annot"><a href="ModelFinder.Solver.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679138303"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679137631"><span id="local-6989586621679138309"><span id="local-6989586621679138313"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GShow</span></span><span> </span><span class="annot"><a href="#local-6989586621679137631"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679137631"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137631"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-309"></span><span>  </span><span id="local-6989586621679138315"><span class="annot"><span class="annottext">showsPrec :: Int -&gt; Def f -&gt; ShowS
</span><a href="#local-6989586621679138315"><span class="hs-identifier hs-var hs-var hs-var hs-var">showsPrec</span></a></span></span><span> </span><span id="local-6989586621679138317"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138317"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679138322"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138322"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679138323"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679138323"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><span class="hs-identifier hs-var">showParen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679138317"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; f x -&gt; ShowS
forall a. Int -&gt; f a -&gt; ShowS
forall k (t :: k -&gt; *) (a :: k). GShow t =&gt; Int -&gt; t a -&gt; ShowS
</span><span class="hs-identifier hs-var">gshowsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138322"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; := &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (c :: k -&gt; Constraint) (f :: k -&gt; *) (a :: k) r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
forall (c :: * -&gt; Constraint) (f :: * -&gt; *) a r.
Has c f =&gt;
f a -&gt; (c a =&gt; r) -&gt; r
</span><span class="hs-identifier hs-var">has</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679138322"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; x -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679138323"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-keyword">newtype</span><span> </span><span id="Solution"><span class="annot"><a href="ModelFinder.Solver.html#Solution"><span class="hs-identifier hs-var">Solution</span></a></span></span><span> </span><span id="local-6989586621679137642"><span class="annot"><a href="#local-6989586621679137642"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Solution"><span class="annot"><a href="ModelFinder.Solver.html#Solution"><span class="hs-identifier hs-var">Solution</span></a></span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137642"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span id="local-6989586621679137639"><span id="local-6989586621679138334"><span id="local-6989586621679138340"><span id="local-6989586621679138344"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GShow</span></span><span> </span><span class="annot"><a href="#local-6989586621679137639"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Has</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679137639"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137639"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span id="local-6989586621679137640"><span class="annot"><a href="ModelFinder.Solver.html#constraintToSolution"><span class="hs-identifier hs-type">constraintToSolution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137640"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ModelFinder.Solver.html#Solution"><span class="hs-identifier hs-type">Solution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679137640"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-316"></span><span id="constraintToSolution"><span class="annot"><span class="annottext">constraintToSolution :: forall (f :: * -&gt; *). Model f -&gt; [Solution f]
</span><a href="ModelFinder.Solver.html#constraintToSolution"><span class="hs-identifier hs-var hs-var">constraintToSolution</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ModelFinder.Solver.html#Model"><span class="hs-identifier hs-type">Model</span></a></span><span> </span><span id="local-6989586621679138349"><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679138349"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Def f] -&gt; Solution f
forall (f :: * -&gt; *). [Def f] -&gt; Solution f
</span><a href="ModelFinder.Solver.html#Solution"><span class="hs-identifier hs-var">Solution</span></a></span><span> </span><span class="annot"><span class="annottext">([Def f] -&gt; Solution f) -&gt; [[Def f]] -&gt; [Solution f]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(DSum f Set -&gt; [Def f]) -&gt; [DSum f Set] -&gt; [[Def f]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679138351"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138351"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:=&gt;</span></span><span> </span><span id="local-6989586621679138352"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138352"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679138351"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">f a -&gt; a -&gt; Def f
forall (f :: * -&gt; *) x. f x -&gt; x -&gt; Def f
</span><a href="ModelFinder.Solver.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Def f) -&gt; [a] -&gt; [Def f]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679138352"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DMap f Set -&gt; [DSum f Set]
forall {k1} (k2 :: k1 -&gt; *) (f :: k1 -&gt; *).
DMap k2 f -&gt; [DSum k2 f]
</span><span class="hs-identifier hs-var">DMap.toList</span></span><span> </span><span class="annot"><span class="annottext">DMap f Set
</span><a href="#local-6989586621679138349"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span></pre></body></html>