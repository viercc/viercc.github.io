<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Too lazy to evaluate - (主張3)の証明が改善の余地ありだったので修正</title>
        
        
        <link rel="stylesheet" href="../css/syntax.css" />
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="icon" type="image/vnd.microsoft.icon" sizes="16x16" href="../favicon.ico" />
        <link rel="icon" type="image/png" sizes="96x96" href="../favicon96.png" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Too lazy to evaluate</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../pdfs.html">PDFs</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>(主張3)の証明が改善の余地ありだったので修正</h1>
            <article>
    <section class="header">
        <ul class="metadata_display_list">
            
                <li>Posted on 2019-12-16</li>
            
            
                <li>Last modified on 2025-02-22</li>
            
            
            
                <li class="post-tags">tags: <a title="All pages tagged 'monad'." href="../tags/monad.html" rel="tag">monad</a>, <a title="All pages tagged 'polynomial'." href="../tags/polynomial.html" rel="tag">polynomial</a></li>
            
        </ul>
    </section>
    <section>
        <h1 id="主張">主張</h1>
<p>ある多項式Functor<code>F</code>が <code>F(x) ~ c + x^2 * G(x)</code>(<code>|c| &gt;= 1, G(x) ~/~ 0</code>)と書けるならば、<code>F</code>の<code>Monad</code>のインスタンスは存在しない。</p>
<p>例:以下のFunctorには<code>Monad</code>のインスタンスを与えることができない。</p>
<ul>
<li><code>F(x) ~ 1 + x^2</code></li>
<li><code>F(x) ~ 3 + x^2 + x^4</code></li>
</ul>
<h1 id="証明">証明</h1>
<p>まず、どんな多項式Functorに対しても、<code>forall x. x -&gt; F x</code>という型を持つ関数があれば、それは<code>F(x)</code>の特定の項
<code>F(x) ~ ... + x^n + ...</code>に対応するコンストラクタに、<code>n</code>個の<code>x</code>のコピーを渡した値を返す。このコンストラクタは、当然、<code>x</code>に依存せずに決まる。</p>
<p>いま問題としている<code>F(x) ~ c + x^2 * G(x)</code>において、Monadの定義における<code>return :: forall x. x -&gt; F x</code>に対応する項が<code>x^n</code>であるとしたら、<code>n == 0</code>であるか、または<code>n &gt;= 2</code>である。</p>
<p>仮に<code>n == 0</code>であったとする。これはすなわち<code>return</code>は定数関数であり、<code>return x</code>の値は<code>x</code>に依存しないことを意味している。しかし、Monad則より<code>join (return fx) = fx</code>でなければならず、また空でない型<code>X</code>において<code>fx :: F X</code>は2つ以上の異なる値を持つので、<code>return</code>は定数関数であってはならない。したがって、<code>n &gt;= 2</code>でなければならない。</p>
<p><code>return</code>の返り値に対応する項<code>x^n</code>を明示して、<code>F(x)</code>が以下のように定義されているとする。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">N</span> <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">C</span> <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">G</span> x <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">F</span> x <span class="ot">=</span> <span class="dt">U</span> (<span class="dt">N</span> <span class="ot">-&gt;</span> x) <span class="op">|</span> <span class="dt">L</span> <span class="dt">C</span> <span class="op">|</span> <span class="dt">R</span> x x (<span class="dt">G</span> x)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span><span class="ot"> ::</span> <span class="kw">forall</span> x<span class="op">.</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span> x <span class="ot">=</span> <span class="dt">U</span> (<span class="fu">const</span> x)</span></code></pre></div>
<p>また、前提条件として与えられている、<code>C</code>に1つ以上の値があることが、次のように表されているとする。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- |C| &gt;= 1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ot">c0 ::</span> <span class="dt">C</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ot">zero ::</span> <span class="kw">forall</span> x<span class="op">.</span> <span class="dt">F</span> x</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>zero <span class="ot">=</span> <span class="dt">L</span> c0</span></code></pre></div>
<p>簡単にわかることとして、<code>join zero = zero</code>がある。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>join (<span class="dt">L</span> c0)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- fmap f (L c) = L c</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="fu">fmap</span> <span class="fu">return</span> <span class="op">$</span> <span class="dt">L</span> c0)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> <span class="fu">return</span> <span class="op">$</span> <span class="dt">L</span> c0</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- join . fmap return = id</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">L</span> c0</span></code></pre></div>
<p>Monad則から、<code>join :: F (F x) -&gt; F x</code>の満たすべき等式として次のものが得られる。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- ∀a :: N -&gt; N -&gt; x</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> <span class="dt">U</span> (\i <span class="ot">-&gt;</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> a i j)) <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> a i i</span></code></pre></div>
<p>以降、この等式は<code>joinUU</code>という名前で呼ぶ。また、これは次のように証明できる。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">coord ::</span> <span class="dt">F</span> (<span class="dt">F</span> (<span class="dt">N</span>, <span class="dt">N</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>coord <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> (i,j)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fmap</span> <span class="fu">fst</span> (join coord)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="fu">fmap</span> (<span class="fu">fmap</span> <span class="fu">fst</span>) coord)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> i)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> <span class="fu">return</span> i)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="fu">fmap</span> <span class="fu">return</span> (<span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> i))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Monad則(join . fmap return = id)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> i</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">fmap</span> <span class="fu">snd</span> (join coord)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="fu">fmap</span> (<span class="fu">fmap</span> <span class="fu">snd</span>) coord)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> j)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join (<span class="fu">return</span> <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> j)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Monad則(join . return = id)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> j</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>join coord <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> (i,i)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> <span class="dt">U</span> (\i <span class="ot">-&gt;</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> a i j))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="fu">fmap</span> (<span class="fu">fmap</span> (<span class="fu">uncurry</span> a)) coord</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="fu">fmap</span> (<span class="fu">uncurry</span> a) <span class="op">$</span> join coord</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="fu">fmap</span> (<span class="fu">uncurry</span> a) <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> (i,i)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \i <span class="ot">-&gt;</span> a i i</span></code></pre></div>
<p>ここで、次の関数を考える。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ot">at ::</span> <span class="kw">forall</span> x<span class="op">.</span> <span class="dt">N</span> <span class="ot">-&gt;</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>at i x <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero)</span></code></pre></div>
<p>以下の事実がわかる。</p>
<ul>
<li>任意の<code>i</code>に対して<code>at i x</code>は<code>x</code>に依存する。</li>
</ul>
<p>これを示すため、いま、ある<code>i :: N</code>において<code>at i x</code>が<code>x</code>に依存しないと仮定する。
このとき、次の<code>sweep f</code>は<code>f i</code>の値に依存しないはずである。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ot">sweep ::</span> <span class="kw">forall</span> x<span class="op">.</span> (<span class="dt">N</span> <span class="ot">-&gt;</span> x) <span class="ot">-&gt;</span> <span class="dt">F</span> (<span class="dt">F</span> x)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sweep f <span class="ot">=</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> at j (f j)</span></code></pre></div>
<p>一方、<code>join $ sweep f</code>を<code>join</code>の結合則を用いて計算すると、以下のようになる。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> sweep f</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> at j (f j))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> join <span class="op">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 結合則</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- joinUU</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="fu">return</span> (f j))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> <span class="fu">return</span> <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> f j)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 単位則</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">U</span> f</span></code></pre></div>
<p>これは明らかに<code>f</code>の任意の点<code>i :: N</code>での値に依存する。これは矛盾である。
よって、仮定したことの否定、任意の<code>i :: N</code>に対して<code>at i x</code>は<code>x</code>に依存する</p>
<p>また、<code>at i</code>に関するさまざまな性質が、<code>Monad</code>則を仮定すると得られる。</p>
<ul>
<li><code>join $ at i (U f) = at i (f i)</code> … (at-U)</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> at i (<span class="dt">U</span> f)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (<span class="dt">U</span> f) <span class="kw">else</span> zero</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> (join <span class="op">.</span> <span class="fu">return</span>) (<span class="dt">U</span> f) <span class="kw">else</span> join zero</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- join . return = id   = join . fmap return</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- join zero     = zero = join (return zero)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> (join <span class="op">.</span> <span class="fu">fmap</span> <span class="fu">return</span>) (<span class="dt">U</span> f) <span class="kw">else</span> join (<span class="fu">return</span> zero)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> (join <span class="op">.</span> <span class="fu">fmap</span> <span class="fu">return</span>) (<span class="dt">U</span> f) <span class="kw">else</span> join (<span class="fu">return</span> zero)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 結合則</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">fmap</span> <span class="fu">return</span> (<span class="dt">U</span> f) <span class="kw">else</span> <span class="fu">return</span> zero</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- fmap return (U f) = U (return . f)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- return zero = U (const zero)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="dt">U</span> (<span class="fu">return</span> <span class="op">.</span> f) <span class="kw">else</span> <span class="dt">U</span> (<span class="fu">const</span> zero)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f k) <span class="kw">else</span> zero</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- joinUU</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- i == j より j を i に置換</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f i) <span class="kw">else</span> zero</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> at i (f i)</span></code></pre></div>
<p>さらに、次の補助関数<code>squash, hole</code>を定義する。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ot">squash ::</span> <span class="dt">N</span> <span class="ot">-&gt;</span> (<span class="kw">forall</span> x<span class="op">.</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x) <span class="ot">-&gt;</span> <span class="dt">F</span> <span class="dt">N</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>squash i u <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> u j <span class="kw">else</span> <span class="fu">return</span> j</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ot">hole ::</span> <span class="kw">forall</span> x<span class="op">.</span> <span class="dt">N</span> <span class="ot">-&gt;</span> <span class="dt">F</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>hole i fx <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> zero <span class="kw">else</span> fx</span></code></pre></div>
<ul>
<li><code>squash i (at i) = U id</code> .. (squash-at)</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>squash i (at i)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> at i j <span class="kw">else</span> <span class="fu">return</span> j</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> join <span class="op">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> j <span class="kw">else</span> zero)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> join <span class="op">.</span> <span class="fu">return</span> <span class="op">.</span> <span class="fu">return</span> <span class="op">$</span> j</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> j <span class="kw">else</span> zero)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="dt">U</span> (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> j)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a> <span class="co">-- 結合則 + joinU</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> j <span class="kw">else</span> zero</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="fu">return</span> j</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="fu">return</span> j</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> <span class="fu">return</span> <span class="op">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> j)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">U</span> <span class="fu">id</span></span></code></pre></div>
<ul>
<li><code>hole i (at i x) = zero</code> … (hole-at)</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>hole i (at i x)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> zero <span class="kw">else</span> (at i x)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> zero</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- join . return = id</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> join <span class="op">$</span> <span class="fu">return</span> zero</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="op">$</span> \k <span class="ot">-&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> zero</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 結合則 + joinUU</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> zero</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> zero</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="fu">return</span> zero</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> zero</span></code></pre></div>
<p>いま、<code>at i x</code>は<code>x</code>に依存するのであった。<code>return</code>のときと同様の議論によって、<code>at i x</code>が返すコンストラクタは2つ以上の<code>x</code>の値に依存することができるので、関数<code>con :: N -&gt; x -&gt; x -&gt; F x</code>が存在して、<code>con i x y</code>は<code>x</code>と<code>y</code>の両方に依存し、
<code>con i x x = at i x</code>となるようにできる。さらに、次の式が成り立つ。</p>
<ul>
<li><code>hole i (con i x y) = zero</code> … (hole-con)</li>
</ul>
<p>これは、<code>hole</code>が<code>x</code>に関して自然、すなわち<code>x</code>型の変数の内容に依存して処理を変えることがないことから
<code>hole i (con i x y)</code> と <code>hole i (con i x x) = hole i (at i x)</code> を区別できないことから、
(hole-at)を組み合わせるとわかる。</p>
<ul>
<li><code>at i (con i x y) = con i x y</code> … (at-con)</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> at i (con i x y)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (con i x y) <span class="kw">else</span> zero</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 結合則</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">return</span> (con i x y) <span class="kw">else</span> zero</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> join (<span class="fu">return</span> (con i x y)) <span class="kw">else</span> join zero</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- (hole-con)より、</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- join zero = zero = hole i (con i x y)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> join <span class="op">$</span> <span class="fu">return</span> (con i x y)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> hole i (con i x y)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> join <span class="op">$</span> <span class="fu">return</span> (con i x y)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> join <span class="op">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> zero <span class="kw">else</span> con i x y)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> <span class="fu">return</span> (con i x y)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> zero <span class="kw">else</span> con i x y)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="op">$</span> \k <span class="ot">-&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> con i x y</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> zero <span class="kw">else</span> con i x y</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 結合則 + joinUU</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> con i x y</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> (<span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> zero <span class="kw">else</span> con i x y)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> con i x y</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">return</span> <span class="op">$</span> con i x y</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> con i x y</span></code></pre></div>
<p>いま、次の関数<code>extra</code>を考える。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ot">extra ::</span> <span class="kw">forall</span> x<span class="op">.</span> <span class="dt">N</span> <span class="ot">-&gt;</span> x <span class="ot">-&gt;</span> x <span class="ot">-&gt;</span> (<span class="dt">N</span> <span class="ot">-&gt;</span> x) <span class="ot">-&gt;</span> <span class="dt">F</span> x</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>extra i x y f <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f j)</span></code></pre></div>
<p><code>extra</code>の特別な場合について計算する。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>extra i (f i) (f i) f</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> con i (f i) (f i) <span class="kw">else</span> <span class="fu">return</span> (f j)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> at i (f i) <span class="kw">else</span> <span class="fu">return</span> (f j)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> <span class="fu">fmap</span> f (at i i) <span class="kw">else</span> <span class="fu">fmap</span> f (<span class="fu">return</span> j)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> (<span class="fu">fmap</span> f) <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> at i i <span class="kw">else</span> <span class="fu">return</span> j</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- i == j より i と j を置換</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- join . fmap (fmap f) = fmap f . join </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="fu">fmap</span> f <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> at i j <span class="kw">else</span> <span class="fu">return</span> j</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="fu">fmap</span> f <span class="op">$</span> squash i (at i)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- (squash-at)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="fu">fmap</span> f <span class="op">$</span> <span class="dt">U</span> <span class="fu">id</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> <span class="dt">U</span> f</span></code></pre></div>
<p><code>extra</code>は<code>x</code>に関して自然なので、任意の<code>x, y, f</code>に関して、
ある<code>g :: N -&gt; x</code>を用いて<code>extra i x y f = U g</code>とならなければならない。
このことを用いると、次のような計算ができる。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> at i (extra i x y f)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> at i (<span class="dt">U</span> g)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- (at-U)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> at i (g i)</span></code></pre></div>
<p>しかし、<code>extra</code>の定義にもとづいて別の計算を行うと、</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>join <span class="op">$</span> at i (extra i x y f)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> extra i x y f</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> zero</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- extraの定義, join . return = id</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> join <span class="op">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f k))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> join (<span class="fu">return</span> zero)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f k))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> <span class="fu">return</span> zero</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">.</span> <span class="fu">fmap</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="op">$</span> \k <span class="ot">-&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> <span class="kw">if</span> i <span class="op">==</span> k <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f k)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> zero</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- 結合則 + joinUU</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> i <span class="op">==</span> j</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>       <span class="kw">then</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f j)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>       <span class="kw">else</span> zero</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> join <span class="op">$</span> <span class="dt">U</span> <span class="op">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="op">==</span> j <span class="kw">then</span> con i x y <span class="kw">else</span> zero</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> at i (con i x y)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- (at-con)</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> con i x y</span></code></pre></div>
<p>である。しかし、<code>at i (g i)</code>は<code>x,y</code>のうち高々一つにしか依存できないのに対し、<code>con i x y</code>は両方に依存する。</p>
<p>これは矛盾である。したがって、<code>Monad</code>則を満たすように<code>F</code>の<code>Monad</code>のインスタンスを与えることはできない。</p>
<h1 id="疑問点">疑問点</h1>
<p>ただちょっとわからない点があって、<code>N</code>が無限であることを許したとき、<code>x == y</code>ならば<code>f x = f y</code>を保証できるような<code>(==) :: N -&gt; N -&gt; Bool</code>が定義できるか？という問題がある。</p>
<p>この証明は、<code>p x = True</code>をみたす<code>x</code>がちょうど1つだけ存在するような <code>p :: N -&gt; Bool</code> が一つでもあれば、<code>(i ==)</code>の代わりにそれを使うように書き換えるのは難しくないはずなので、このような<code>p</code>が存在しないかもしれない、という問題といってもいい。</p>
<p>まず、<code>|N| &gt;= 2</code>なる条件をHaskellで表現するなら、次の両方が成り立つことだ（と思う）。</p>
<ul>
<li>ある<code>inj :: Bool -&gt; N</code>が存在して、任意の<code>X :: Type</code>, <code>f, g :: X -&gt; Bool</code>に対して<code>inj . f = inj . g</code>ならば<code>f = g</code></li>
<li>ある<code>surj :: N -&gt; Bool</code>が存在して、任意の<code>X :: Type</code>, <code>f, g :: Bool -&gt; X</code>に対して<code>f . surj = g . surj</code>ならば<code>f = g</code></li>
</ul>
<p>しかし、これを満たすにもかかわらず、<code>(==)</code>が定義できないような型がある。先程の条件を満たす<code>p</code>も無い。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">newtype</span> <span class="dt">BitStream</span> <span class="ot">=</span> <span class="dt">BitStream</span> (<span class="dt">Bool</span>, <span class="dt">BitStream</span> <span class="dt">Bool</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ot">inj ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">BitStream</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>inj x <span class="ot">=</span> <span class="dt">BitStream</span> (x, inj x)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="ot">surj ::</span> <span class="dt">BitStream</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>surj (<span class="dt">BitStream</span> (x, _)) <span class="ot">=</span> x</span></code></pre></div>
<p><del>ただ、<code>N = BitStream</code>のとき、<code>join</code>は全域関数にできないだろう。一般に、<code>N</code>が<code>(==)</code>が定義できない(or 条件を満たす<code>p</code>が無い)ような型ならば、<code>join</code>は全域関数にできないと言えるか？</del></p>
<p><strong>2019.12.17 追記</strong> なんか一晩寝たら解決した！</p>
<p><code>BitStream</code>には、次の関数<code>search</code>が定義できる。<code>search</code>は、
ある全域関数<code>p :: BitStream -&gt; Bool</code>をとり、
<code>p bs = True</code>となる<code>bs</code>があればそのような<code>bs</code>を返す。
さもなくば、適当な<code>bs :: BitStream</code>を返す。
<code>p</code>が全域関数ならば<code>search p</code>も常にbottom以外の値を返す。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ot">cons ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">BitStream</span> <span class="ot">-&gt;</span> <span class="dt">BitStream</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>cons b bs <span class="ot">=</span> <span class="dt">BitStream</span> (b, bs)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ot">search ::</span> (<span class="dt">BitStream</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>) <span class="ot">-&gt;</span> <span class="dt">BitStream</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>search p <span class="ot">=</span> <span class="kw">let</span> candidate <span class="ot">=</span> search (p <span class="op">.</span> cons <span class="dt">False</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>           <span class="kw">in</span> <span class="kw">if</span> p (cons <span class="dt">False</span> candidate)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                <span class="kw">then</span> cons <span class="dt">False</span> candidate</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                <span class="kw">else</span> cons <span class="dt">True</span>  (search (p <span class="op">.</span> cons <span class="dt">True</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ot">forSome ::</span> (<span class="dt">BitStream</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>) <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>forSome p <span class="ot">=</span> p (search p)</span></code></pre></div>
<p><code>F = ReaderT BitStream Maybe</code>は、当然に<code>Monad</code>である。一方、</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">F</span> x <span class="ot">=</span> <span class="dt">BitStream</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> x</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ot">zero ::</span> <span class="kw">forall</span> x<span class="op">.</span> <span class="dt">F</span> x</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>zero <span class="ot">=</span> <span class="fu">const</span> <span class="dt">Nothing</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="ot">isZero ::</span> <span class="kw">forall</span> x<span class="op">.</span> <span class="dt">F</span> x <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>isZero <span class="ot">=</span> <span class="fu">not</span> <span class="op">.</span> forSome (isJust <span class="op">.</span> mx) </span></code></pre></div>
<p>と定義すると、<code>isZero mx = True</code> ⇔ <code>mx = zero</code>なので、<code>F x</code>は少なくとも一つの”定数項”と、それ以外の直和である。</p>
<p><code>isZero mx = False</code>となるような<code>mx :: F X</code>のうち、“自由度”(<code>x^n</code> の <code>n</code>)が1のものがあったとする。このとき、以下のようになるはずである。</p>
<ul>
<li><code>x :: X</code>が存在して、<code>x &lt;$ mx = mx</code></li>
<li>任意の<code>my :: F Y</code>について、<code>x &lt;$ my = mx</code>なら、<code>y :: Y</code>が存在して<code>y &lt;$ my = my</code></li>
</ul>
<p>しかし、次のように定義される<code>mi</code>を考えよう。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ot">mi ::</span> <span class="dt">F</span> <span class="dt">BitStream</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mi <span class="ot">=</span> join <span class="op">$</span> \bs <span class="ot">-&gt;</span> <span class="dt">Just</span> (bs <span class="op">&lt;$</span> mx)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">&lt;$</span> mi</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> x <span class="op">&lt;$</span> (join <span class="op">$</span> \bs <span class="ot">-&gt;</span> <span class="dt">Just</span> (bs <span class="op">&lt;$</span> mx))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">.</span> <span class="fu">fmap</span> (x <span class="op">&lt;$</span>) <span class="op">$</span> \bs <span class="ot">-&gt;</span> <span class="dt">Just</span> (bs <span class="op">&lt;$</span> mx)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> \bs <span class="ot">-&gt;</span> <span class="dt">Just</span> (x <span class="op">&lt;$</span> (bs <span class="op">&lt;$</span> mx))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> \bs <span class="ot">-&gt;</span> <span class="dt">Just</span> (x <span class="op">&lt;$</span> mx)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> join <span class="op">$</span> \bs <span class="ot">-&gt;</span> <span class="dt">Just</span> mx</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> <span class="ot">=</span> mx</span></code></pre></div>
<p>なので、<code>i :: ByteStream</code>が存在して、<code>i &lt;$ mi = mi</code>である。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ot">p ::</span> <span class="dt">ByteStream</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> isJust <span class="op">.</span> mi</span></code></pre></div>
<p>を考えると、</p>
<ol type="1">
<li><code>p j = True</code>となるような<code>j</code>が存在する。</li>
<li><code>p j = True</code>ならば、<code>mi j = Just j</code>である。</li>
<li><code>p j = True</code>ならば、<code>mi j = (i &lt;$ mi) j = Just i</code>である。</li>
<li><code>p j = True</code>ならば<code>i = j</code>である。</li>
</ol>
<p>となるが、このような性質を持つ（全域関数）<code>p</code>は存在しないのだった。したがって、<code>F X</code>に”自由度”が1の項は存在しない。
よって、<code>F = ReaderT BitStream Maybe</code>は</p>
<ul>
<li>“定数項”とそれ以外との直和に書かれる</li>
<li>“自由度”が1の項は存在しない</li>
</ul>
<p>ので、多項式Functorの定義として無限次数と無限個の項を許したならば、<code>F</code>は(主張)の<strong>反例になる</strong>。</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
