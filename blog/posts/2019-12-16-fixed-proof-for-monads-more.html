<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Too lazy to evaluate - (主張3)の証明が改善の余地ありだったので修正</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="../css/syntax.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Too lazy to evaluate</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>(主張3)の証明が改善の余地ありだったので修正</h1>
            <article>
    <section class="header">
        Posted on December 16, 2019
        
    </section>
    <section>
        <h1 id="主張">主張</h1>
<p>ある多項式Functor<code>F</code>が <code>F(x) ~ c + x^2 * G(x)</code>(<code>|c| &gt;= 1, G(x) ~/~ 0</code>)と書けるならば、<code>F</code>の<code>Monad</code>のインスタンスは存在しない。</p>
<p>例:以下のFunctorには<code>Monad</code>のインスタンスを与えることができない。</p>
<ul>
<li><code>F(x) ~ 1 + x^2</code></li>
<li><code>F(x) ~ 3 + x^2 + x^4</code></li>
</ul>
<h1 id="証明">証明</h1>
<p>まず、どんな多項式Functorに対しても、<code>forall x. x -&gt; F x</code>という型を持つ関数があれば、それは<code>F(x)</code>の特定の項 <code>F(x) ~ ... + x^n + ...</code>に対応するコンストラクタに、<code>n</code>個の<code>x</code>のコピーを渡した値を返す。このコンストラクタは、当然、<code>x</code>に依存せずに決まる。</p>
<p>いま問題としている<code>F(x) ~ c + x^2 * G(x)</code>において、Monadの定義における<code>return :: forall x. x -&gt; F x</code>に対応する項が<code>x^n</code>であるとしたら、<code>n == 0</code>であるか、または<code>n &gt;= 2</code>である。</p>
<p>仮に<code>n == 0</code>であったとする。これはすなわち<code>return</code>は定数関数であり、<code>return x</code>の値は<code>x</code>に依存しないことを意味している。しかし、Monad則より<code>join (return fx) = fx</code>でなければならず、また空でない型<code>X</code>において<code>fx :: F X</code>は2つ以上の異なる値を持つので、<code>return</code>は定数関数であってはならない。したがって、<code>n &gt;= 2</code>でなければならない。</p>
<p><code>return</code>の返り値に対応する項<code>x^n</code>を明示して、<code>F(x)</code>が以下のように定義されているとする。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">type</span> <span class="dt">N</span> <span class="fu">=</span> <span class="fu">...</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">type</span> <span class="dt">C</span> <span class="fu">=</span> <span class="fu">...</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">type</span> <span class="dt">G</span> x <span class="fu">=</span> <span class="fu">...</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">data</span> <span class="dt">F</span> x <span class="fu">=</span> <span class="dt">U</span> (<span class="dt">N</span> <span class="ot">-&gt;</span> x) <span class="fu">|</span> <span class="dt">L</span> <span class="dt">C</span> <span class="fu">|</span> <span class="dt">R</span> x x (<span class="dt">G</span> x)</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="fu">return</span><span class="ot"> ::</span> <span class="kw">forall</span> x<span class="fu">.</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="fu">return</span> x <span class="fu">=</span> <span class="dt">U</span> (<span class="fu">const</span> x)</a></code></pre></div>
<p>また、前提条件として与えられている、<code>C</code>に1つ以上の値があることが、次のように表されているとする。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="co">-- |C| &gt;= 1</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ot">c0 ::</span> <span class="dt">C</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="ot">zero ::</span> <span class="kw">forall</span> x<span class="fu">.</span> <span class="dt">F</span> x</a>
<a class="sourceLine" id="cb2-4" title="4">zero <span class="fu">=</span> <span class="dt">L</span> c0</a></code></pre></div>
<p>簡単にわかることとして、<code>join zero = zero</code>がある。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1">join (<span class="dt">L</span> c0)</a>
<a class="sourceLine" id="cb3-2" title="2">   <span class="co">-- fmap f (L c) = L c</span></a>
<a class="sourceLine" id="cb3-3" title="3"> <span class="fu">=</span> join (<span class="fu">fmap</span> <span class="fu">return</span> <span class="fu">$</span> <span class="dt">L</span> c0)</a>
<a class="sourceLine" id="cb3-4" title="4"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> <span class="fu">return</span> <span class="fu">$</span> <span class="dt">L</span> c0</a>
<a class="sourceLine" id="cb3-5" title="5">   <span class="co">-- join . fmap return = id</span></a>
<a class="sourceLine" id="cb3-6" title="6"> <span class="fu">=</span> <span class="dt">L</span> c0</a></code></pre></div>
<p>Monad則から、<code>join :: F (F x) -&gt; F x</code>の満たすべき等式として次のものが得られる。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="co">-- ∀a :: N -&gt; N -&gt; x</span></a>
<a class="sourceLine" id="cb4-2" title="2">join <span class="fu">$</span> <span class="dt">U</span> (\i <span class="ot">-&gt;</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> a i j)) <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> a i i</a></code></pre></div>
<p>以降、この等式は<code>joinUU</code>という名前で呼ぶ。また、これは次のように証明できる。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">coord ::</span> <span class="dt">F</span> (<span class="dt">F</span> (<span class="dt">N</span>, <span class="dt">N</span>))</a>
<a class="sourceLine" id="cb5-2" title="2">coord <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> (i,j)</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="fu">fmap</span> <span class="fu">fst</span> (join coord)</a>
<a class="sourceLine" id="cb5-5" title="5"> <span class="fu">=</span> join (<span class="fu">fmap</span> (<span class="fu">fmap</span> <span class="fu">fst</span>) coord)</a>
<a class="sourceLine" id="cb5-6" title="6"> <span class="fu">=</span> join (<span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> i)</a>
<a class="sourceLine" id="cb5-7" title="7"> <span class="fu">=</span> join (<span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> <span class="fu">return</span> i)</a>
<a class="sourceLine" id="cb5-8" title="8"> <span class="fu">=</span> join (<span class="fu">fmap</span> <span class="fu">return</span> (<span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> i))</a>
<a class="sourceLine" id="cb5-9" title="9">   <span class="co">-- Monad則(join . fmap return = id)</span></a>
<a class="sourceLine" id="cb5-10" title="10"> <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> i</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="fu">fmap</span> <span class="fu">snd</span> (join coord)</a>
<a class="sourceLine" id="cb5-13" title="13"> <span class="fu">=</span> join (<span class="fu">fmap</span> (<span class="fu">fmap</span> <span class="fu">snd</span>) coord)</a>
<a class="sourceLine" id="cb5-14" title="14"> <span class="fu">=</span> join (<span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> j)</a>
<a class="sourceLine" id="cb5-15" title="15"> <span class="fu">=</span> join (<span class="fu">return</span> <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> j)</a>
<a class="sourceLine" id="cb5-16" title="16">   <span class="co">-- Monad則(join . return = id)</span></a>
<a class="sourceLine" id="cb5-17" title="17"> <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> j</a>
<a class="sourceLine" id="cb5-18" title="18"></a>
<a class="sourceLine" id="cb5-19" title="19">join coord <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> (i,i)</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21">join <span class="fu">$</span> <span class="dt">U</span> (\i <span class="ot">-&gt;</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> a i j))</a>
<a class="sourceLine" id="cb5-22" title="22"> <span class="fu">=</span> join <span class="fu">$</span> <span class="fu">fmap</span> (<span class="fu">fmap</span> (<span class="fu">uncurry</span> a)) coord</a>
<a class="sourceLine" id="cb5-23" title="23"> <span class="fu">=</span> <span class="fu">fmap</span> (<span class="fu">uncurry</span> a) <span class="fu">$</span> join coord</a>
<a class="sourceLine" id="cb5-24" title="24"> <span class="fu">=</span> <span class="fu">fmap</span> (<span class="fu">uncurry</span> a) <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> (i,i)</a>
<a class="sourceLine" id="cb5-25" title="25"> <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \i <span class="ot">-&gt;</span> a i i</a></code></pre></div>
<p>ここで、次の関数を考える。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="ot">at ::</span> <span class="kw">forall</span> x<span class="fu">.</span> <span class="dt">N</span> <span class="ot">-&gt;</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x</a>
<a class="sourceLine" id="cb6-2" title="2">at i x <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero)</a></code></pre></div>
<p>以下の事実がわかる。</p>
<ul>
<li>任意の<code>i</code>に対して<code>at i x</code>は<code>x</code>に依存する。</li>
</ul>
<p>これを示すため、いま、ある<code>i :: N</code>において<code>at i x</code>が<code>x</code>に依存しないと仮定する。 このとき、次の<code>sweep f</code>は<code>f i</code>の値に依存しないはずである。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="ot">sweep ::</span> <span class="kw">forall</span> x<span class="fu">.</span> (<span class="dt">N</span> <span class="ot">-&gt;</span> x) <span class="ot">-&gt;</span> <span class="dt">F</span> (<span class="dt">F</span> x)</a>
<a class="sourceLine" id="cb7-2" title="2">sweep f <span class="fu">=</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> at j (f j)</a></code></pre></div>
<p>一方、<code>join $ sweep f</code>を<code>join</code>の結合則を用いて計算すると、以下のようになる。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1">join <span class="fu">$</span> sweep f</a>
<a class="sourceLine" id="cb8-2" title="2"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> at j (f j))</a>
<a class="sourceLine" id="cb8-3" title="3"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> join <span class="fu">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero))</a>
<a class="sourceLine" id="cb8-4" title="4"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero))</a>
<a class="sourceLine" id="cb8-5" title="5">   <span class="co">-- 結合則</span></a>
<a class="sourceLine" id="cb8-6" title="6"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero))</a>
<a class="sourceLine" id="cb8-7" title="7">   <span class="co">-- joinUU</span></a>
<a class="sourceLine" id="cb8-8" title="8"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="kw">if</span> j <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero)</a>
<a class="sourceLine" id="cb8-9" title="9"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> <span class="fu">return</span> (f j))</a>
<a class="sourceLine" id="cb8-10" title="10"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> <span class="fu">return</span> <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> f j)</a>
<a class="sourceLine" id="cb8-11" title="11">   <span class="co">-- 単位則</span></a>
<a class="sourceLine" id="cb8-12" title="12"> <span class="fu">=</span> <span class="dt">U</span> f</a></code></pre></div>
<p>これは明らかに<code>f</code>の任意の点<code>i :: N</code>での値に依存する。これは矛盾である。 よって、仮定したことの否定、任意の<code>i :: N</code>に対して<code>at i x</code>は<code>x</code>に依存する</p>
<p>また、<code>at i</code>に関するさまざまな性質が、<code>Monad</code>則を仮定すると得られる。</p>
<ul>
<li><code>join $ at i (U f) = at i (f i)</code> … (at-U)</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1">join <span class="fu">$</span> at i (<span class="dt">U</span> f)</a>
<a class="sourceLine" id="cb9-2" title="2"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (<span class="dt">U</span> f) <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb9-3" title="3"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> (join <span class="fu">.</span> <span class="fu">return</span>) (<span class="dt">U</span> f) <span class="kw">else</span> join zero</a>
<a class="sourceLine" id="cb9-4" title="4">   <span class="co">-- join . return = id   = join . fmap return</span></a>
<a class="sourceLine" id="cb9-5" title="5">   <span class="co">-- join zero     = zero = join (return zero)</span></a>
<a class="sourceLine" id="cb9-6" title="6"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> (join <span class="fu">.</span> <span class="fu">fmap</span> <span class="fu">return</span>) (<span class="dt">U</span> f) <span class="kw">else</span> join (<span class="fu">return</span> zero)</a>
<a class="sourceLine" id="cb9-7" title="7"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> (join <span class="fu">.</span> <span class="fu">fmap</span> <span class="fu">return</span>) (<span class="dt">U</span> f) <span class="kw">else</span> join (<span class="fu">return</span> zero)</a>
<a class="sourceLine" id="cb9-8" title="8">   <span class="co">-- 結合則</span></a>
<a class="sourceLine" id="cb9-9" title="9"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">fmap</span> <span class="fu">return</span> (<span class="dt">U</span> f) <span class="kw">else</span> <span class="fu">return</span> zero</a>
<a class="sourceLine" id="cb9-10" title="10">   <span class="co">-- fmap return (U f) = U (return . f)</span></a>
<a class="sourceLine" id="cb9-11" title="11">   <span class="co">-- return zero = U (const zero)</span></a>
<a class="sourceLine" id="cb9-12" title="12"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="dt">U</span> (<span class="fu">return</span> <span class="fu">.</span> f) <span class="kw">else</span> <span class="dt">U</span> (<span class="fu">const</span> zero)</a>
<a class="sourceLine" id="cb9-13" title="13"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f k) <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb9-14" title="14">   <span class="co">-- joinUU</span></a>
<a class="sourceLine" id="cb9-15" title="15"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f j) <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb9-16" title="16">   <span class="co">-- i == j より j を i に置換</span></a>
<a class="sourceLine" id="cb9-17" title="17"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (f i) <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb9-18" title="18"> <span class="fu">=</span> at i (f i)</a></code></pre></div>
<p>さらに、次の補助関数<code>squash, hole</code>を定義する。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1"><span class="ot">squash ::</span> <span class="dt">N</span> <span class="ot">-&gt;</span> (<span class="kw">forall</span> x<span class="fu">.</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x) <span class="ot">-&gt;</span> <span class="dt">F</span> <span class="dt">N</span></a>
<a class="sourceLine" id="cb10-2" title="2">squash i u <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> u j <span class="kw">else</span> <span class="fu">return</span> j</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="ot">hole ::</span> <span class="kw">forall</span> x<span class="fu">.</span> <span class="dt">N</span> <span class="ot">-&gt;</span> <span class="dt">F</span> x <span class="ot">-&gt;</span> <span class="dt">F</span> x</a>
<a class="sourceLine" id="cb10-5" title="5">hole i fx <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> zero <span class="kw">else</span> fx</a></code></pre></div>
<ul>
<li><code>squash i (at i) = U id</code> .. (squash-at)</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1">squash i (at i)</a>
<a class="sourceLine" id="cb11-2" title="2"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> at i j <span class="kw">else</span> <span class="fu">return</span> j</a>
<a class="sourceLine" id="cb11-3" title="3"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-4" title="4">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb11-5" title="5">       <span class="kw">then</span> join <span class="fu">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> j <span class="kw">else</span> zero)</a>
<a class="sourceLine" id="cb11-6" title="6">       <span class="kw">else</span> join <span class="fu">.</span> <span class="fu">return</span> <span class="fu">.</span> <span class="fu">return</span> <span class="fu">$</span> j</a>
<a class="sourceLine" id="cb11-7" title="7"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-8" title="8">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb11-9" title="9">       <span class="kw">then</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> j <span class="kw">else</span> zero)</a>
<a class="sourceLine" id="cb11-10" title="10">       <span class="kw">else</span> <span class="dt">U</span> (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> j)</a>
<a class="sourceLine" id="cb11-11" title="11"> <span class="co">-- 結合則 + joinU</span></a>
<a class="sourceLine" id="cb11-12" title="12"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-13" title="13">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb11-14" title="14">       <span class="kw">then</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> j <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb11-15" title="15">       <span class="kw">else</span> <span class="fu">return</span> j</a>
<a class="sourceLine" id="cb11-16" title="16"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="fu">return</span> j</a>
<a class="sourceLine" id="cb11-17" title="17"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> <span class="fu">return</span> <span class="fu">$</span> <span class="dt">U</span> (\j <span class="ot">-&gt;</span> j)</a>
<a class="sourceLine" id="cb11-18" title="18"> <span class="fu">=</span> <span class="dt">U</span> <span class="fu">id</span></a></code></pre></div>
<ul>
<li><code>hole i (at i x) = zero</code> … (hole-at)</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1">hole i (at i x)</a>
<a class="sourceLine" id="cb12-2" title="2"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> zero <span class="kw">else</span> (at i x)</a>
<a class="sourceLine" id="cb12-3" title="3"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-4" title="4">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb12-5" title="5">       <span class="kw">then</span> zero</a>
<a class="sourceLine" id="cb12-6" title="6">       <span class="kw">else</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb12-7" title="7">   <span class="co">-- join . return = id</span></a>
<a class="sourceLine" id="cb12-8" title="8"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-9" title="9">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb12-10" title="10">       <span class="kw">then</span> join <span class="fu">$</span> <span class="fu">return</span> zero</a>
<a class="sourceLine" id="cb12-11" title="11">       <span class="kw">else</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb12-12" title="12"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="fu">$</span> \k <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-13" title="13">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb12-14" title="14">       <span class="kw">then</span> zero</a>
<a class="sourceLine" id="cb12-15" title="15">       <span class="kw">else</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb12-16" title="16">   <span class="co">-- 結合則 + joinUU</span></a>
<a class="sourceLine" id="cb12-17" title="17"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-18" title="18">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb12-19" title="19">       <span class="kw">then</span> zero</a>
<a class="sourceLine" id="cb12-20" title="20">       <span class="kw">else</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> x <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb12-21" title="21"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> zero</a>
<a class="sourceLine" id="cb12-22" title="22"> <span class="fu">=</span> join <span class="fu">$</span> <span class="fu">return</span> zero</a>
<a class="sourceLine" id="cb12-23" title="23"> <span class="fu">=</span> zero</a></code></pre></div>
<p>いま、<code>at i x</code>は<code>x</code>に依存するのであった。<code>return</code>のときと同様の議論によって、<code>at i x</code>が返すコンストラクタは2つ以上の<code>x</code>の値に依存することができるので、関数<code>con :: N -&gt; x -&gt; x -&gt; F x</code>が存在して、<code>con i x y</code>は<code>x</code>と<code>y</code>の両方に依存し、 <code>con i x x = at i x</code>となるようにできる。さらに、次の式が成り立つ。</p>
<ul>
<li><code>hole i (con i x y) = zero</code> … (hole-con)</li>
</ul>
<p>これは、<code>hole</code>が<code>x</code>に関して自然、すなわち<code>x</code>型の変数の内容に依存して処理を変えることがないことから <code>hole i (con i x y)</code> と <code>hole i (con i x x) = hole i (at i x)</code> を区別できないことから、 (hole-at)を組み合わせるとわかる。</p>
<ul>
<li><code>at i (con i x y) = con i x y</code> … (at-con)</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1">join <span class="fu">$</span> at i (con i x y)</a>
<a class="sourceLine" id="cb13-2" title="2"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (con i x y) <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb13-3" title="3">   <span class="co">-- 結合則</span></a>
<a class="sourceLine" id="cb13-4" title="4"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">return</span> (con i x y) <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb13-5" title="5"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> join (<span class="fu">return</span> (con i x y)) <span class="kw">else</span> join zero</a>
<a class="sourceLine" id="cb13-6" title="6">   <span class="co">-- (hole-con)より、</span></a>
<a class="sourceLine" id="cb13-7" title="7">   <span class="co">-- join zero = zero = hole i (con i x y)</span></a>
<a class="sourceLine" id="cb13-8" title="8"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-9" title="9">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb13-10" title="10">       <span class="kw">then</span> join <span class="fu">$</span> <span class="fu">return</span> (con i x y)</a>
<a class="sourceLine" id="cb13-11" title="11">       <span class="kw">else</span> hole i (con i x y)</a>
<a class="sourceLine" id="cb13-12" title="12"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-13" title="13">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb13-14" title="14">       <span class="kw">then</span> join <span class="fu">$</span> <span class="fu">return</span> (con i x y)</a>
<a class="sourceLine" id="cb13-15" title="15">       <span class="kw">else</span> join <span class="fu">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> zero <span class="kw">else</span> con i x y)</a>
<a class="sourceLine" id="cb13-16" title="16"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-17" title="17">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb13-18" title="18">       <span class="kw">then</span> <span class="fu">return</span> (con i x y)</a>
<a class="sourceLine" id="cb13-19" title="19">       <span class="kw">else</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> zero <span class="kw">else</span> con i x y)</a>
<a class="sourceLine" id="cb13-20" title="20"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="fu">$</span> \k <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-21" title="21">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb13-22" title="22">       <span class="kw">then</span> con i x y</a>
<a class="sourceLine" id="cb13-23" title="23">       <span class="kw">else</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> zero <span class="kw">else</span> con i x y</a>
<a class="sourceLine" id="cb13-24" title="24">   <span class="co">-- 結合則 + joinUU</span></a>
<a class="sourceLine" id="cb13-25" title="25"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-26" title="26">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb13-27" title="27">       <span class="kw">then</span> con i x y</a>
<a class="sourceLine" id="cb13-28" title="28">       <span class="kw">else</span> (<span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> zero <span class="kw">else</span> con i x y)</a>
<a class="sourceLine" id="cb13-29" title="29"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> con i x y</a>
<a class="sourceLine" id="cb13-30" title="30"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">return</span> <span class="fu">$</span> con i x y</a>
<a class="sourceLine" id="cb13-31" title="31"> <span class="fu">=</span> con i x y</a></code></pre></div>
<p>いま、次の関数<code>extra</code>を考える。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" title="1"><span class="ot">extra ::</span> <span class="kw">forall</span> x<span class="fu">.</span> <span class="dt">N</span> <span class="ot">-&gt;</span> x <span class="ot">-&gt;</span> x <span class="ot">-&gt;</span> (<span class="dt">N</span> <span class="ot">-&gt;</span> x) <span class="ot">-&gt;</span> <span class="dt">F</span> x</a>
<a class="sourceLine" id="cb14-2" title="2">extra i x y f <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f j)</a></code></pre></div>
<p><code>extra</code>の特別な場合について計算する。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" title="1">extra i (f i) (f i) f</a>
<a class="sourceLine" id="cb15-2" title="2"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> con i (f i) (f i) <span class="kw">else</span> <span class="fu">return</span> (f j)</a>
<a class="sourceLine" id="cb15-3" title="3"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> at i (f i) <span class="kw">else</span> <span class="fu">return</span> (f j)</a>
<a class="sourceLine" id="cb15-4" title="4"> <span class="fu">=</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> <span class="fu">fmap</span> f (at i i) <span class="kw">else</span> <span class="fu">fmap</span> f (<span class="fu">return</span> j)</a>
<a class="sourceLine" id="cb15-5" title="5"> <span class="fu">=</span> join <span class="fu">.</span> <span class="fu">fmap</span> (<span class="fu">fmap</span> f) <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> at i i <span class="kw">else</span> <span class="fu">return</span> j</a>
<a class="sourceLine" id="cb15-6" title="6">   <span class="co">-- i == j より i と j を置換</span></a>
<a class="sourceLine" id="cb15-7" title="7">   <span class="co">-- join . fmap (fmap f) = fmap f . join </span></a>
<a class="sourceLine" id="cb15-8" title="8"> <span class="fu">=</span> <span class="fu">fmap</span> f <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> at i j <span class="kw">else</span> <span class="fu">return</span> j</a>
<a class="sourceLine" id="cb15-9" title="9"> <span class="fu">=</span> <span class="fu">fmap</span> f <span class="fu">$</span> squash i (at i)</a>
<a class="sourceLine" id="cb15-10" title="10">   <span class="co">-- (squash-at)</span></a>
<a class="sourceLine" id="cb15-11" title="11"> <span class="fu">=</span> <span class="fu">fmap</span> f <span class="fu">$</span> <span class="dt">U</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb15-12" title="12"> <span class="fu">=</span> <span class="dt">U</span> f</a></code></pre></div>
<p><code>extra</code>は<code>x</code>に関して自然なので、任意の<code>x, y, f</code>に関して、 ある<code>g :: N -&gt; x</code>を用いて<code>extra i x y f = U g</code>とならなければならない。 このことを用いると、次のような計算ができる。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" title="1">join <span class="fu">$</span> at i (extra i x y f)</a>
<a class="sourceLine" id="cb16-2" title="2"> <span class="fu">=</span> join <span class="fu">$</span> at i (<span class="dt">U</span> g)</a>
<a class="sourceLine" id="cb16-3" title="3">   <span class="co">-- (at-U)</span></a>
<a class="sourceLine" id="cb16-4" title="4"> <span class="fu">=</span> at i (g i)</a></code></pre></div>
<p>しかし、<code>extra</code>の定義にもとづいて別の計算を行うと、</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" title="1">join <span class="fu">$</span> at i (extra i x y f)</a>
<a class="sourceLine" id="cb17-2" title="2"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-3" title="3">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb17-4" title="4">       <span class="kw">then</span> extra i x y f</a>
<a class="sourceLine" id="cb17-5" title="5">       <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb17-6" title="6">   <span class="co">-- extraの定義, join . return = id</span></a>
<a class="sourceLine" id="cb17-7" title="7"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-8" title="8">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb17-9" title="9">       <span class="kw">then</span> join <span class="fu">$</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f k))</a>
<a class="sourceLine" id="cb17-10" title="10">       <span class="kw">else</span> join (<span class="fu">return</span> zero)</a>
<a class="sourceLine" id="cb17-11" title="11"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-12" title="12">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb17-13" title="13">       <span class="kw">then</span> <span class="dt">U</span> (\k <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f k))</a>
<a class="sourceLine" id="cb17-14" title="14">       <span class="kw">else</span> <span class="fu">return</span> zero</a>
<a class="sourceLine" id="cb17-15" title="15"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">.</span> <span class="fu">fmap</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="dt">U</span> <span class="fu">$</span> \k <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-16" title="16">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb17-17" title="17">       <span class="kw">then</span> <span class="kw">if</span> i <span class="fu">==</span> k <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f k)</a>
<a class="sourceLine" id="cb17-18" title="18">       <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb17-19" title="19">   <span class="co">-- 結合則 + joinUU</span></a>
<a class="sourceLine" id="cb17-20" title="20"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb17-21" title="21">     <span class="kw">if</span> i <span class="fu">==</span> j</a>
<a class="sourceLine" id="cb17-22" title="22">       <span class="kw">then</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> con i x y <span class="kw">else</span> <span class="fu">return</span> (f j)</a>
<a class="sourceLine" id="cb17-23" title="23">       <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb17-24" title="24"> <span class="fu">=</span> join <span class="fu">.</span> join <span class="fu">$</span> <span class="dt">U</span> <span class="fu">$</span> \j <span class="ot">-&gt;</span> <span class="kw">if</span> i <span class="fu">==</span> j <span class="kw">then</span> con i x y <span class="kw">else</span> zero</a>
<a class="sourceLine" id="cb17-25" title="25"> <span class="fu">=</span> join <span class="fu">$</span> at i (con i x y)</a>
<a class="sourceLine" id="cb17-26" title="26">   <span class="co">-- (at-con)</span></a>
<a class="sourceLine" id="cb17-27" title="27"> <span class="fu">=</span> con i x y</a></code></pre></div>
<p>である。しかし、<code>at i (g i)</code>は<code>x,y</code>のうち高々一つにしか依存できないのに対し、<code>con i x y</code>は両方に依存する。</p>
<p>これは矛盾である。したがって、<code>Monad</code>則を満たすように<code>F</code>の<code>Monad</code>のインスタンスを与えることはできない。</p>
<h1 id="疑問点">疑問点</h1>
<p>ただちょっとわからない点があって、<code>N</code>が無限であることを許したとき、<code>x == y</code>ならば<code>f x = f y</code>を保証できるような<code>(==) :: N -&gt; N -&gt; Bool</code>が定義できるか？という問題がある。</p>
<p>この証明は、<code>p x = True</code>をみたす<code>x</code>がちょうど1つだけ存在するような <code>p :: N -&gt; Bool</code> が一つでもあれば、<code>(i ==)</code>の代わりにそれを使うように書き換えるのは難しくないはずなので、このような<code>p</code>が存在しないかもしれない、という問題といってもいい。</p>
<p>まず、<code>|N| &gt;= 2</code>なる条件をHaskellで表現するなら、次の両方が成り立つことだ（と思う）。</p>
<ul>
<li>ある<code>inj :: Bool -&gt; N</code>が存在して、任意の<code>X :: Type</code>, <code>f, g :: X -&gt; Bool</code>に対して<code>inj . f = inj . g</code>ならば<code>f = g</code></li>
<li>ある<code>surj :: N -&gt; Bool</code>が存在して、任意の<code>X :: Type</code>, <code>f, g :: Bool -&gt; X</code>に対して<code>f . surj = g . surj</code>ならば<code>f = g</code></li>
</ul>
<p>しかし、これを満たすにもかかわらず、<code>(==)</code>が定義できないような型がある。先程の条件を満たす<code>p</code>も無い。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">newtype</span> <span class="dt">BitStream</span> <span class="fu">=</span> <span class="dt">BitStream</span> (<span class="dt">Bool</span>, <span class="dt">BitStream</span> <span class="dt">Bool</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="ot">inj ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">BitStream</span></a>
<a class="sourceLine" id="cb18-4" title="4">inj x <span class="fu">=</span> <span class="dt">BitStream</span> (x, inj x)</a>
<a class="sourceLine" id="cb18-5" title="5"></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="ot">surj ::</span> <span class="dt">BitStream</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb18-7" title="7">surj (<span class="dt">BitStream</span> (x, _)) <span class="fu">=</span> x</a></code></pre></div>
<p>ただ、<code>N = BitStream</code>のとき、<code>join</code>は全域関数にできないだろう。一般に、<code>N</code>が<code>(==)</code>が定義できない(or 条件を満たす<code>p</code>が無い)ような型ならば、<code>join</code>は全域関数にできないと言えるか？</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
